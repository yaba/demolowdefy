(()=>{"use strict";var e={4793:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Aggregator=void 0;var n=r(8257),o=r(2439),i=r(7045),s=function(){function e(e,t){this.__pipeline=e,this.__options=n.makeOptions(t)}return e.prototype.stream=function(e){var t=o.Lazy(e);if(!i.isEmpty(this.__pipeline))for(var r=0,s=this.__pipeline;r<s.length;r++){var a=s[r],u=Object.keys(a),c=u[0],l=n.getOperator(n.OperatorType.PIPELINE,c);i.assert(1===u.length&&!!l,"invalid aggregation operator "+c),t=l(t,a[c],this.__options)}return t},e.prototype.run=function(e){return this.stream(e).value()},e}();t.Aggregator=s},8257:(e,t,r)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.redact=t.computeValue=t.addOperators=t.getOperator=t.useOperators=t.OperatorType=t.makeOptions=void 0;var o,i=r(7045);function s(e){return Object.assign({idKey:"_id"},e||{})}t.makeOptions=s,function(e){e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query"}(o=t.OperatorType||(t.OperatorType={}));var a=((n={})[o.ACCUMULATOR]={},n[o.EXPRESSION]={},n[o.PIPELINE]={},n[o.PROJECTION]={},n[o.QUERY]={},n);function u(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=r[t],o=n[0],s=n[1];i.assert(s instanceof Function&&i.isOperator(o),"invalid operator specified")}}function c(e,t){u(t),i.into(a[e],t)}function l(e,t){return i.has(a[e],t)?a[e][t]:null}t.useOperators=c,t.getOperator=l,t.addOperators=function(e,t){var r=t({computeValue:f,resolve:i.resolve});u(r);for(var n=0,s=Object.entries(r);n<s.length;n++){var a=s[n],p=a[0],d=(a[1],l(e,p));i.assert(!d,p+" already exists for '"+e+"' operators")}var y={};switch(e){case o.QUERY:for(var h=function(e,t){var n=t.bind(r);y[e]=function(e,t,r){return function(o){var s=i.resolve(o,e,{unwrapArray:!0});return n(e,s,t,r)}}},v=0,g=Object.entries(r);v<g.length;v++){var m=g[v];h(p=m[0],m[1])}break;case o.PROJECTION:for(var b=function(e,t){var n=t.bind(r);y[e]=function(e,t,r,o){var s=i.resolve(e,r);return n(r,s,t,o)}},O=0,_=Object.entries(r);O<_.length;O++){var M=_[O];b(p=M[0],M[1])}break;default:for(var $=function(e,t){y[e]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.apply(r,e)}},j=0,w=Object.entries(r);j<w.length;j++){var S=w[j];$(p=S[0],S[1])}}c(e,y)};var p={$$ROOT:function(e,t,r){return r.root},$$CURRENT:function(e,t,r){return e},$$REMOVE:function(e,t,r){}},d={$$KEEP:function(e,t,r){return e},$$PRUNE:function(e,t,r){},$$DESCEND:function(e,t,r){if(!i.has(t,"$cond"))return e;for(var n,o=i.cloneDeep(e),s=0,a=Object.entries(o);s<a.length;s++){var u=a[s],c=u[0],l=u[1];if(i.isObjectLike(l)){if(l instanceof Array){for(var p=[],d=0,f=l;d<f.length;d++){var h=f[d];i.isObject(h)&&(h=y(h,t,r)),i.isNil(h)||p.push(h)}n=p}else n=y(l,t,r);i.isNil(n)?delete o[c]:o[c]=n}}return o}};function f(e,t,r,n){if(n=n||s(),i.isOperator(r)){var u=l(o.EXPRESSION,r);if(u)return u(e,t,n);if(u=l(o.ACCUMULATOR,r))return e instanceof Array||(e=f(e,t,null,n),t=null),i.assert(e instanceof Array,"'"+r+"' target must be an array."),u(e,t,n);throw new Error("operator '"+r+"' is not registered")}if(i.isString(t)&&t.length>0&&"$"===t[0]){if(i.has(d,t))return t;var c=t.split(".");if(i.has(p,c[0])){if(e=p[c[0]](e,null,i.into({root:e},n)),1==c.length)return e;t=t.substr(c[0].length)}return i.resolve(e,t.slice(1))}if(t instanceof Array)return t.map((function(t){return f(e,t,null,n)}));if(i.isObject(t)){for(var y={},h=function(r,s){if(y[r]=f(e,s,r,n),[o.EXPRESSION,o.ACCUMULATOR].some((function(e){return i.has(a[e],r)})))return i.assert(1===Object.keys(t).length,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),{value:y[r]}},v=0,g=Object.entries(t);v<g.length;v++){var m=g[v],b=h(m[0],m[1]);if("object"==typeof b)return b.value}return y}return t}function y(e,t,r){var n=f(e,t,null,r);return i.has(d,n)?d[n](e,t,i.into({root:e},r)):n}t.computeValue=f,t.redact=y},7336:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cursor=void 0;var n=r(4793),o=r(2439),i=r(7045),s=function(){function e(e,t,r,n){this.__predicateFn=t,this.__source=e,this.__projection=r,this.__operators=[],this.__result=null,this.__stack=[],this.__options=n}return e.prototype._fetch=function(){return this.__result||(i.isObject(this.__projection)&&this.__operators.push({$project:this.__projection}),this.__result=o.Lazy(this.__source).filter(this.__predicateFn),this.__operators.length>0&&(this.__result=new n.Aggregator(this.__operators,this.__options).stream(this.__result))),this.__result},e.prototype.all=function(){return this._fetch().value()},e.prototype.count=function(){return this.all().length},e.prototype.skip=function(e){return this.__operators.push({$skip:e}),this},e.prototype.limit=function(e){return this.__operators.push({$limit:e}),this},e.prototype.sort=function(e){return this.__operators.push({$sort:e}),this},e.prototype.collation=function(e){return i.into(this.__options,{collation:e}),this},e.prototype.next=function(){if(this.__stack){if(this.__stack.length>0)return this.__stack.pop();var e=this._fetch().next();if(!e.done)return e.value;this.__stack=null}},e.prototype.hasNext=function(){if(!this.__stack)return!1;if(this.__stack.length>0)return!0;var e=this._fetch().next();return e.done?this.__stack=null:this.__stack.push(e.value),!!this.__stack},e.prototype.map=function(e){return this._fetch().map(e).value()},e.prototype.forEach=function(e){this._fetch().each(e)},e}();t.Cursor=s,"function"==typeof Symbol&&(s.prototype[Symbol.iterator]=function(){return this._fetch()})},2439:(e,t)=>{function r(e){return e instanceof s?e:new s(e)}function n(e,t){var r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.Iterator=t.Lazy=void 0,t.Lazy=r;var o,i=new Error;!function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"}(o||(o={}));var s=function(){function e(e){var t,r,s,a,u,c,l,p,d;if(this.__iteratees=[],this.__first=!1,this.__done=!1,this.__buf=[],e instanceof Function&&(e={next:e}),(r=e)&&"object"==typeof r&&(null===(s=r)||void 0===s?void 0:s.next)instanceof Function){var f=e;t=function(){var e=f.next();if(e.done)throw i;return e.value}}else if(e instanceof Array){var y=e,h=y.length,v=0;t=function(){if(v<h)return y[v++];throw i}}else if(!(e instanceof Function))throw new Error("Source is not iterable. Must be Array, Function, or Generator");this.__next=(a=t,u=this.__iteratees,c=this.__buf,l=!1,p=-1,d=0,function(e){try{e:for(;!l;){var t=a();p++;for(var r=-1,s=u.length,f=!1;++r<s;){var y=u[r];switch(y.action){case o.MAP:t=y.func(t,p);break;case o.FILTER:if(!y.func(t,p))continue e;break;case o.TAKE:--y.count,y.count||(f=!0);break;case o.DROP:--y.count,y.count||n(u,r);continue e;default:break e}}if(l=f,!e)return{value:t,done:!1};c[d++]=t}}catch(e){if(e!==i)throw e}return{done:l=!0}})}return e.prototype._validate=function(){if(this.__first)throw new Error("Cannot add iteratee/transform after `first()`")},e.prototype._push=function(e,t){if(this._validate(),"function"==typeof t)this.__iteratees.push({action:e,func:t});else{if("number"!=typeof t)throw Error("invalid value");this.__iteratees.push({action:e,count:t})}return this},e.prototype.next=function(){return this.__next()},e.prototype.map=function(e){return this._push(o.MAP,e)},e.prototype.filter=function(e){return this._push(o.FILTER,e)},e.prototype.take=function(e){return e>0?this._push(o.TAKE,e):this},e.prototype.drop=function(e){return e>0?this._push(o.DROP,e):this},e.prototype.transform=function(e){this._validate();var t,n=this;return r((function(){return t||(t=r(e(n.value()))),t.next()}))},e.prototype.first=function(){return this.take(1),this.__first=!0,this},e.prototype.value=function(){return this.__done||(this.__done=this.__next(!0).done),this.__first?this.__buf[0]:this.__buf},e.prototype.each=function(e){for(;;){var t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0},e.prototype.reduce=function(e,t){var r=this.next(),n=0;for(void 0!==t||r.done||(t=r.value,r=this.next(),n++);!r.done;)t=e(t,r.value,n++),r=this.next();return t},e.prototype.size=function(){return this.reduce((function(e,t){return++e}),0)},e}();t.Iterator=s,"function"==typeof Symbol&&(s.prototype[Symbol.iterator]=function(){return this})},2408:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$type=t.$elemMatch=t.$size=t.$all=t.$exists=t.$regex=t.$mod=t.$gte=t.$gt=t.$lte=t.$lt=t.$nin=t.$in=t.$ne=t.$eq=t.createExpressionOperator=t.createQueryOperator=void 0;var n=r(8257),o=r(7054),i=r(7045);function s(e,t,r){if(i.isEqual(e,t))return!0;if(i.isNil(e)&&i.isNil(t))return!0;if(e instanceof Array){var n=i.isEqual.bind(null,t);return e.some(n)||i.flatten(e,1).some(n)}return!1}function a(e,t,r){return i.isNil(e)?t.some(i.isNull):i.intersection(i.ensureArray(e),t,null==r?void 0:r.hashFunction).length>0}function u(e){return i.isOperator(e)&&-1===["$and","$or","$nor"].indexOf(e)}function c(e,t,r){if(i.isArray(e)&&!i.isEmpty(e)){var n=function(e){return e},s=t;Object.keys(t).every(u)&&(s={temp:t},n=function(e){return{temp:e}});for(var a=new o.Query(s,r),c=0,l=e.length;c<l;c++)if(a.test(n(e[c])))return!0}return!1}function l(e,t,r){return i.ensureArray(e).some((function(e){return i.getType(e)===i.getType(t)&&r(e,t)}))}t.createQueryOperator=function(e){return function(t,r,n){var o={unwrapArray:!0};return function(s){var a=i.resolve(s,t,o);return e(a,r,n)}}},t.createExpressionOperator=function(e){return function(t,r,o){var i=n.computeValue(t,r,null,o);return e.apply(void 0,i)}},t.$eq=s,t.$ne=function(e,t,r){return!s(e,t)},t.$in=a,t.$nin=function(e,t,r){return!a(e,t,r)},t.$lt=function(e,t,r){return l(e,t,(function(e,t){return e<t}))},t.$lte=function(e,t,r){return l(e,t,(function(e,t){return e<=t}))},t.$gt=function(e,t,r){return l(e,t,(function(e,t){return e>t}))},t.$gte=function(e,t,r){return l(e,t,(function(e,t){return e>=t}))},t.$mod=function(e,t,r){return i.ensureArray(e).some((function(e){return 2===t.length&&e%t[0]===t[1]}))},t.$regex=function(e,t,r){var n=i.ensureArray(e),o=function(e){return i.isString(e)&&!!t.exec(e)};return n.some(o)||i.flatten(n,1).some(o)},t.$exists=function(e,t,r){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e},t.$all=function(e,t,r){var n=!1;if(i.isArray(e)&&i.isArray(t))for(var o=0,s=t.length;o<s;o++){if(!i.isObject(t[o])||!i.inArray(Object.keys(t[o]),"$elemMatch"))return i.intersection(t,e,null==r?void 0:r.hashFunction).length===s;n=n||c(e,t[o].$elemMatch,r)}return n},t.$size=function(e,t,r){return e.length===t},t.$elemMatch=c,t.$type=function(e,t,r){switch(t){case 1:case 19:case i.BsonType.DOUBLE:case i.BsonType.DECIMAL:return i.isNumber(e);case 2:case i.JsType.STRING:return i.isString(e);case 3:case i.JsType.OBJECT:return i.isObject(e);case 4:case i.JsType.ARRAY:return i.isArray(e);case 6:case i.JsType.UNDEFINED:return i.isNil(e);case 8:case i.JsType.BOOLEAN:case i.BsonType.BOOL:return i.isBoolean(e);case 9:case i.JsType.DATE:return i.isDate(e);case 10:case i.JsType.NULL:return i.isNull(e);case 11:case i.JsType.REGEXP:case i.BsonType.REGEX:return i.isRegExp(e);case 16:case i.BsonType.INT:return i.isNumber(e)&&e>=i.MIN_INT&&e<=i.MAX_INT&&-1===e.toString().indexOf(".");case 18:case i.BsonType.LONG:return i.isNumber(e)&&e>=i.MIN_LONG&&e<=i.MAX_LONG&&-1===e.toString().indexOf(".");default:return!1}}},7058:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stddev=void 0,t.stddev=function(e,t){var r=e.reduce((function(e,t){return e+t}),0),n=e.length||1,o=t?1:0,i=r/n;return Math.sqrt(e.reduce((function(e,t){return e+Math.pow(t-i,2)}),0)/(n-o))}},9418:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$addToSet=void 0;var n=r(7045),o=r(3123);t.$addToSet=function(e,t,r){return n.unique(o.$push(e,t,r),null==r?void 0:r.hashFunction)}},144:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$avg=void 0;var n=r(7045),o=r(3123);t.$avg=function(e,t,r){var i=o.$push(e,t,r).filter(n.isNumber);return i.reduce((function(e,t){return e+t}),0)/(i.length||1)}},8625:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$first=void 0;var n=r(8257);t.$first=function(e,t,r){return e.length>0?n.computeValue(e[0],t,null,r):void 0}},7661:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(9418),t),o(r(144),t),o(r(8625),t),o(r(3274),t),o(r(4094),t),o(r(270),t),o(r(9081),t),o(r(3123),t),o(r(5679),t),o(r(8570),t),o(r(5660),t)},3274:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$last=void 0;var n=r(8257);t.$last=function(e,t,r){return e.length>0?n.computeValue(e[e.length-1],t,null,r):void 0}},4094:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$max=void 0;var n=r(3123);t.$max=function(e,t,r){var o=n.$push(e,t,r).reduce((function(e,t){return t>e?t:e}),-1/0);return o===-1/0?void 0:o}},270:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$mergeObjects=void 0;var n=r(1455);t.$mergeObjects=n.$mergeObjects},9081:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$min=void 0;var n=r(3123);t.$min=function(e,t,r){var o=n.$push(e,t,r).reduce((function(e,t){return t<e?t:e}),1/0);return o===1/0?void 0:o}},3123:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$push=void 0;var n=r(8257),o=r(7045);t.$push=function(e,t,r){return o.isNil(t)?e:e.map((function(e){return n.computeValue(e,t,null,r)}))}},5679:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$stdDevPop=void 0;var n=r(7045),o=r(7058),i=r(3123);t.$stdDevPop=function(e,t,r){return o.stddev(i.$push(e,t,r).filter(n.isNumber),!1)}},8570:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$stdDevSamp=void 0;var n=r(7045),o=r(7058),i=r(3123);t.$stdDevSamp=function(e,t,r){return o.stddev(i.$push(e,t,r).filter(n.isNumber),!0)}},5660:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sum=void 0;var n=r(7045),o=r(3123);t.$sum=function(e,t,r){return n.isArray(e)?n.isNumber(t)?e.length*t:o.$push(e,t,r).filter(n.isNumber).reduce((function(e,t){return e+t}),0):0}},3224:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.truncate=void 0,t.truncate=function(e,t,r){var n=Math.abs(e)===e?1:-1;e=Math.abs(e);var o=Math.trunc(e),i=e-o;if(0===t){var s=Math.trunc(10*i);r&&1==(1&o)&&s>=5&&o++}else if(t>0){var a=Math.pow(10,t),u=Math.trunc(i*a),c=Math.trunc(i*a*10)%10;r&&c>5&&(u+=1),o+=u/a}else if(t<0){var l=o%(a=Math.pow(10,-1*t));if(o=Math.max(0,o-l),r&&-1===n){for(;l>10;)l-=l%10;o>0&&l>=5&&(o+=a)}}return o*n}},658:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$abs=void 0;var n=r(8257),o=r(7045);t.$abs=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:Math.abs(i)}},8635:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$add=void 0;var n=r(8257),o=r(7045);t.$add=function(e,t,r){var i=n.computeValue(e,t,null,r),s=!1,a=i.reduce((function(e,t){return o.isDate(t)&&(o.assert(!s,"'$add' can only have one date value"),s=!0,t=t.getTime()),e+t}),0);return s?new Date(a):a}},315:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$ceil=void 0;var n=r(8257),o=r(7045);t.$ceil=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:(o.assert(o.isNumber(i)||isNaN(i),"$ceil expression must resolve to a number."),Math.ceil(i))}},6710:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$divide=void 0;var n=r(8257);t.$divide=function(e,t,r){var o=n.computeValue(e,t,null,r);return o[0]/o[1]}},8440:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$exp=void 0;var n=r(8257),o=r(7045);t.$exp=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:(o.assert(o.isNumber(i)||isNaN(i),"$exp expression must resolve to a number."),Math.exp(i))}},1135:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$floor=void 0;var n=r(8257),o=r(7045);t.$floor=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:(o.assert(o.isNumber(i)||isNaN(i),"$floor expression must resolve to a number."),Math.floor(i))}},874:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(658),t),o(r(8635),t),o(r(315),t),o(r(6710),t),o(r(8440),t),o(r(1135),t),o(r(4552),t),o(r(1947),t),o(r(5995),t),o(r(6639),t),o(r(7652),t),o(r(5991),t),o(r(8268),t),o(r(6631),t),o(r(393),t),o(r(1542),t)},4552:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$ln=void 0;var n=r(8257),o=r(7045);t.$ln=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:(o.assert(o.isNumber(i)||isNaN(i),"$ln expression must resolve to a number."),Math.log(i))}},1947:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$log=void 0;var n=r(8257),o=r(7045);t.$log=function(e,t,r){var i=n.computeValue(e,t,null,r),s="$log expression must resolve to array(2) of numbers";return o.assert(o.isArray(i)&&2===i.length,s),i.some(o.isNil)?null:(o.assert(i.some(isNaN)||i.every(o.isNumber),s),Math.log10(i[0])/Math.log10(i[1]))}},5995:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$log10=void 0;var n=r(8257),o=r(7045);t.$log10=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:(o.assert(o.isNumber(i)||isNaN(i),"$log10 expression must resolve to a number."),Math.log10(i))}},6639:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$mod=void 0;var n=r(8257);t.$mod=function(e,t,r){var o=n.computeValue(e,t,null,r);return o[0]%o[1]}},7652:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$multiply=void 0;var n=r(8257);t.$multiply=function(e,t,r){return n.computeValue(e,t,null,r).reduce((function(e,t){return e*t}),1)}},5991:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$pow=void 0;var n=r(8257),o=r(7045);t.$pow=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.assert(o.isArray(i)&&2===i.length&&i.every(o.isNumber),"$pow expression must resolve to array(2) of numbers"),o.assert(!(0===i[0]&&i[1]<0),"$pow cannot raise 0 to a negative exponent"),Math.pow(i[0],i[1])}},8268:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$round=void 0;var n=r(8257),o=r(7045),i=r(3224);t.$round=function(e,t,r){var s=n.computeValue(e,t,null,r),a=s[0],u=s[1];return o.isNil(a)||isNaN(a)||Math.abs(a)===1/0?a:(o.assert(o.isNumber(a),"$round expression must resolve to a number."),i.truncate(a,u,!0))}},6631:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sqrt=void 0;var n=r(8257),o=r(7045);t.$sqrt=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:(o.assert(o.isNumber(i)&&i>0||isNaN(i),"$sqrt expression must resolve to non-negative number."),Math.sqrt(i))}},393:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$subtract=void 0;var n=r(8257);t.$subtract=function(e,t,r){var o=n.computeValue(e,t,null,r);return o[0]-o[1]}},1542:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$trunc=void 0;var n=r(8257),o=r(7045),i=r(3224);t.$trunc=function(e,t,r){var s=n.computeValue(e,t,null,r),a=s[0],u=s[1];return o.isNil(a)||isNaN(a)||Math.abs(a)===1/0?a:(o.assert(o.isNumber(a),"$trunc expression must resolve to a number."),o.assert(o.isNil(u)||o.isNumber(u)&&u>-20&&u<100,"$trunc expression has invalid place"),i.truncate(a,u,!1))}},8922:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$arrayElemAt=void 0;var n=r(8257),o=r(7045);t.$arrayElemAt=function(e,t,r){var i=n.computeValue(e,t,null,r);if(o.assert(i instanceof Array&&2===i.length,"$arrayElemAt expression must resolve to array(2)"),i.some(o.isNil))return null;var s=i[1],a=i[0];return s<0&&Math.abs(s)<=a.length?a[(s+a.length)%a.length]:s>=0&&s<a.length?a[s]:void 0}},1760:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$arrayToObject=void 0;var n=r(8257),o=r(7045);t.$arrayToObject=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.assert(o.isArray(i),"$arrayToObject expression must resolve to an array"),i.reduce((function(e,t){if(t instanceof Array&&2==t.length)e[t[0]]=t[1];else{var r=t;o.assert(o.isObject(r)&&o.has(r,"k")&&o.has(r,"v"),"$arrayToObject expression is invalid."),e[r.k]=r.v}return e}),{})}},1133:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$concatArrays=void 0;var n=r(8257),o=r(7045);t.$concatArrays=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.assert(o.isArray(i),"$concatArrays must resolve to an array"),i.some(o.isNil)?null:i.reduce((function(e,t){return o.into(e,t)}),[])}},2803:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$filter=void 0;var n=r(8257),o=r(7045);t.$filter=function(e,t,r){var i=n.computeValue(e,t.input,null,r);return o.assert(o.isArray(i),"$filter 'input' expression must resolve to an array"),i.filter((function(e){var o={};return o["$"+t.as]=e,!0===n.computeValue(o,t.cond,null,r)}))}},1288:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$in=void 0;var n=r(8257),o=r(7045);t.$in=function(e,t,r){var i=n.computeValue(e,t,null,r),s=i[0],a=i[1];return o.assert(o.isArray(a),"$in second argument must be an array"),a.some(o.isEqual.bind(null,s))}},3244:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(8922),t),o(r(1760),t),o(r(1133),t),o(r(2803),t),o(r(1288),t),o(r(5133),t),o(r(5763),t),o(r(4802),t),o(r(6908),t),o(r(3271),t),o(r(773),t),o(r(5445),t),o(r(8467),t),o(r(625),t),o(r(6195),t)},5133:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$indexOfArray=void 0;var n=r(8257),o=r(7045);t.$indexOfArray=function(e,t,r){var i=n.computeValue(e,t,null,r);if(o.isNil(i))return null;var s=i[0],a=i[1];if(o.isNil(s))return null;o.assert(o.isArray(s),"$indexOfArray expression must resolve to an array.");var u=i[2]||0,c=i[3];if(o.isNil(c)&&(c=s.length),u>c)return-1;o.assert(u>=0&&c>=0,"$indexOfArray expression is invalid"),(u>0||c<s.length)&&(s=s.slice(u,c));var l=-1;return s.some((function(e,t){var r=o.isEqual(e,a);return r&&(l=t),r})),l+u}},5763:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$isArray=void 0;var n=r(8257);t.$isArray=function(e,t,r){return n.computeValue(e,t[0],null,r)instanceof Array}},4802:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$map=void 0;var n=r(8257),o=r(7045);t.$map=function(e,t,r){var i=n.computeValue(e,t.input,null,r);o.assert(o.isArray(i),"$map 'input' expression must resolve to an array");var s=t.as||"this",a=t.in,u="$"+s;return i.map((function(t){return e[u]=t,n.computeValue(e,a,null,r)}))}},6908:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$nin=void 0;var n=r(2408);t.$nin=n.createExpressionOperator(n.$nin)},3271:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$range=void 0;var n=r(8257);t.$range=function(e,t,r){for(var o=n.computeValue(e,t,null,r),i=o[0],s=o[1],a=o[2]||1,u=new Array,c=i;c<s&&a>0||c>s&&a<0;)u.push(c),c+=a;return u}},773:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$reduce=void 0;var n=r(8257),o=r(7045);t.$reduce=function(e,t,r){var i=n.computeValue(e,t.input,null,r),s=n.computeValue(e,t.initialValue,null,r),a=t.in;return o.isNil(i)?null:(o.assert(o.isArray(i),"$reduce 'input' expression must resolve to an array"),i.reduce((function(e,t){return n.computeValue({$value:e,$this:t},a,null,r)}),s))}},5445:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$reverseArray=void 0;var n=r(8257),o=r(7045);t.$reverseArray=function(e,t,r){var i=n.computeValue(e,t,null,r);if(o.isNil(i))return null;o.assert(o.isArray(i),"$reverseArray expression must resolve to an array");var s=[];return o.into(s,i),s.reverse(),s}},8467:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$size=void 0;var n=r(8257),o=r(7045);t.$size=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isArray(i)?i.length:void 0}},625:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$slice=void 0;var n=r(8257),o=r(7045);t.$slice=function(e,t,r){var i=n.computeValue(e,t,null,r),s=i[0],a=i[1],u=i[2];return o.isNil(u)?a<0?(a=Math.max(0,s.length+a),u=s.length-a+1):(u=a,a=0):(a<0&&(a=Math.max(0,s.length+a)),o.assert(u>0,"Invalid argument for $slice operator. Limit must be a positive number"),u+=a),s.slice(a,u)}},6195:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$zip=void 0;var n=r(8257),o=r(7045);t.$zip=function(e,t,r){var i=n.computeValue(e,t.inputs,null,r),s=t.useLongestLength||!1;o.assert(o.isArray(i),"'inputs' expression must resolve to an array"),o.assert(o.isBoolean(s),"'useLongestLength' must be a boolean"),o.isArray(t.defaults)&&o.assert(o.truthy(s),"'useLongestLength' must be set to true to use 'defaults'");for(var a=0,u=0,c=i.length;u<c;u++){var l=i[u];if(o.isNil(l))return null;o.assert(o.isArray(l),"'inputs' expression values must resolve to an array or null"),a=s?Math.max(a,l.length):Math.min(a||l.length,l.length)}var p=[],d=t.defaults||[],f=function(e){var t=i.map((function(t,r){return o.isNil(t[e])?d[r]||null:t[e]}));p.push(t)};for(u=0;u<a;u++)f(u);return p}},7841:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$and=void 0;var n=r(8257),o=r(7045);t.$and=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.truthy(i)&&i.every(o.truthy)}},6248:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7841),t),o(r(6535),t),o(r(8472),t)},6535:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$not=void 0;var n=r(8257),o=r(7045);t.$not=function(e,t,r){var i=o.ensureArray(t);if(0==i.length)return!1;if(1==i.length)return!n.computeValue(e,i[0],null,r);throw"Expression $not takes exactly 1 argument"}},8472:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$or=void 0;var n=r(8257),o=r(7045);t.$or=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.truthy(i)&&i.some(o.truthy)}},1521:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$cmp=t.$ne=t.$lte=t.$lt=t.$gte=t.$gt=t.$eq=void 0;var n=r(8257),o=r(2408);t.$eq=o.createExpressionOperator(o.$eq),t.$gt=o.createExpressionOperator(o.$gt),t.$gte=o.createExpressionOperator(o.$gte),t.$lt=o.createExpressionOperator(o.$lt),t.$lte=o.createExpressionOperator(o.$lte),t.$ne=o.createExpressionOperator(o.$ne),t.$cmp=function(e,t,r){var o=n.computeValue(e,t,null,r);return o[0]>o[1]?1:o[0]<o[1]?-1:0}},965:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$cond=void 0;var n=r(8257),o=r(7045);t.$cond=function(e,t,r){var i,s,a,u="$cond: invalid arguments";t instanceof Array?(o.assert(3===t.length,u),i=t[0],s=t[1],a=t[2]):(o.assert(o.isObject(t),u),i=t.if,s=t.then,a=t.else);var c=n.computeValue(e,i,null,r);return n.computeValue(e,c?s:a,null,r)}},2849:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$ifNull=void 0;var n=r(8257),o=r(7045);t.$ifNull=function(e,t,r){o.assert(o.isArray(t)&&2===t.length,"$ifNull expression must resolve to array(2)");var i=n.computeValue(e,t,null,r);return o.isNil(i[0])?i[1]:i[0]}},5703:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(965),t),o(r(2849),t),o(r(1011),t)},1011:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$switch=void 0;var n=r(8257);t.$switch=function(e,t,r){var o=null;return t.branches.some((function(t){var i=n.computeValue(e,t.case,null,r);return!0===i&&(o=t.then),i})),n.computeValue(e,null!==o?o:t.default,null,r)}},7408:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.regexStrip=t.regexQuote=t.padDigits=t.computeDate=t.adjustDate=t.formatTimezone=t.parseTimezone=t.DATE_SYM_TABLE=t.DATE_PART_INTERVAL=t.DATE_FORMAT=t.MINUTES_PER_HOUR=t.MILLIS_PER_DAY=void 0;var n=r(8257),o=r(7045);function i(e){if(o.isNil(e))return{hour:0,minute:0};var r=t.DATE_SYM_TABLE["%z"].re.exec(e);if(!r)throw Error("invalid or location-based timezone '"+e+"' not supported");return{hour:parseInt(r[2])||0,minute:parseInt(r[3])||0}}function s(e,t){var r=t.hour<0?-1:1;e.setUTCHours(e.getUTCHours()+t.hour),e.setUTCMinutes(e.getUTCMinutes()+r*t.minute)}function a(e,t){return new Array(Math.max(t-String(e).length+1,0)).join("0")+e.toString()}t.MILLIS_PER_DAY=864e5,t.MINUTES_PER_HOUR=60,t.DATE_FORMAT="%Y-%m-%dT%H:%M:%S.%LZ",t.DATE_PART_INTERVAL=[["year",0,9999],["month",1,12],["day",1,31],["hour",0,23],["minute",0,59],["second",0,59],["millisecond",0,999]],t.DATE_SYM_TABLE={"%Y":{name:"year",padding:4,re:/([0-9]{4})/},"%G":{name:"year",padding:4,re:/([0-9]{4})/},"%m":{name:"month",padding:2,re:/(0[1-9]|1[012])/},"%d":{name:"day",padding:2,re:/(0[1-9]|[12][0-9]|3[01])/},"%H":{name:"hour",padding:2,re:/([01][0-9]|2[0-3])/},"%M":{name:"minute",padding:2,re:/([0-5][0-9])/},"%S":{name:"second",padding:2,re:/([0-5][0-9]|60)/},"%L":{name:"millisecond",padding:3,re:/([0-9]{3})/},"%u":{name:"weekDay",padding:1,re:/([1-7])/},"%V":{name:"week",padding:1,re:/([1-4][0-9]?|5[0-3]?)/},"%z":{name:"timezone",padding:2,re:/(([+-][01][0-9]|2[0-3]):?([0-5][0-9])?)/},"%Z":{name:"minuteOffset",padding:3,re:/([+-][0-9]{3})/}},t.parseTimezone=i,t.formatTimezone=function(e){return(e.hour<0?"-":"+")+a(Math.abs(e.hour),2)+a(e.minute,2)},t.adjustDate=s,t.computeDate=function(e,t,r){var a=n.computeValue(e,t,null,r);if(o.isDate(a))return a;if(o.isString(a))throw Error("cannot take a string as an argument");var u=new Date(a),c=null,l=0,p=a;if(o.isObject(p)&&o.has(p,"date")&&o.has(p,"timezone")&&(c=i(n.computeValue(e,p.timezone,null,r)),l=n.computeValue(e,p.date,null,r),u=new Date(l)),isNaN(u.getTime()))throw Error("cannot convert "+(null==e?void 0:e.toString())+" to date");return s(u,c),u},t.padDigits=a,t.regexQuote=function(e){return"^.-*?$".split("").forEach((function(t){e=e.replace(t,"\\"+t)})),e},t.regexStrip=function(e){return e.replace(/^\//,"").replace(/\/$/,"")}},7320:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$dateFromParts=void 0;var n=r(8257),o=r(7408);t.$dateFromParts=function(e,t,r){for(var i=n.computeValue(e,t,null,r),s=o.parseTimezone(i.timezone),a=o.DATE_PART_INTERVAL.length-1,u=0;a>=0;a--){var c=o.DATE_PART_INTERVAL[a],l=c[0],p=c[1],d=c[2],f=(i[l]||0)+u,y=d+1;if("hour"==l&&(f+=-1*s.hour),"minute"==l&&(f+=-1*s.minute),f<p){var h=p-f;u=-1*Math.ceil(h/y),f=y-h%y}else f>d&&(f+=p,u=Math.trunc(f/y),f%=y);i[l]=f}return new Date(Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.millisecond))}},8593:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$dateFromString=void 0;var n=r(8257),o=r(7045),i=r(7408);t.$dateFromString=function(e,t,r){var s=n.computeValue(e,t,null,r);s.format=s.format||i.DATE_FORMAT,s.onNull=s.onNull||null;var a=s.dateString;if(o.isNil(a))return s.onNull;var u=s.format.split(/%[YGmdHMSLuVzZ]/);u.reverse();for(var c=s.format.match(/(%%|%Y|%G|%m|%d|%H|%M|%S|%L|%u|%V|%z|%Z)/g),l={},p="",d=0,f=c.length;d<f;d++){var y=c[d],h=i.DATE_SYM_TABLE[y];if(o.isObject(h)){var v=h.re.exec(a),g=u.pop()||"";null!==v?(l[h.name]=/^\d+$/.exec(v[0])?parseInt(v[0]):v[0],a=a.substr(0,v.index)+a.substr(v.index+v[0].length),p+=i.regexQuote(g)+i.regexStrip(h.re.toString())):l[h.name]=null}}if(o.isNil(l.year)||o.isNil(l.month)||o.isNil(l.day)||!new RegExp("^"+p+"$").exec(s.dateString))return s.onError;var m=i.parseTimezone(s.timezone),b=new Date(Date.UTC(l.year,l.month-1,l.day,0,0,0));return o.isNil(l.hour)||b.setUTCHours(l.hour),o.isNil(l.minute)||b.setUTCMinutes(l.minute),o.isNil(l.second)||b.setUTCSeconds(l.second),o.isNil(l.millisecond)||b.setUTCMilliseconds(l.millisecond),m.minute=0,i.adjustDate(b,m),b}},4408:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$dateToParts=void 0;var n=r(8257),o=r(7408);t.$dateToParts=function(e,t,r){var i=n.computeValue(e,t,null,r);if(!0===i.iso8601)throw new Error("$dateToParts: argument 'iso8601' is not supported");var s=new Date(i.date),a=o.parseTimezone(i.timezone);return a.hour*=-1,a.minute*=-1,o.adjustDate(s,a),{year:s.getUTCFullYear(),month:s.getUTCMonth()+1,day:s.getUTCDate(),hour:s.getUTCHours(),minute:s.getUTCMinutes(),second:s.getUTCSeconds(),millisecond:s.getUTCMilliseconds()}}},7021:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$dateToString=void 0;var n=r(8257),o=r(7045),i=r(7408),s=r(1976),a=r(4330),u=r(8994),c=r(7961),l=r(4938),p=r(3833),d=r(8715),f=r(8595),y=r(9631),h={"%Y":y.$year,"%G":y.$year,"%m":p.$month,"%d":s.$dayOfMonth,"%H":u.$hour,"%M":l.$minute,"%S":d.$second,"%L":c.$millisecond,"%u":a.$dayOfWeek,"%V":f.$week};t.$dateToString=function(e,t,r){var s=n.computeValue(e,t,null,r);if(o.isNil(s.onNull)&&(s.onNull=null),o.isNil(s.date))return s.onNull;var a=i.computeDate(e,s.date,r),u=s.format||i.DATE_FORMAT,c=i.parseTimezone(s.timezone),l=u.match(/(%%|%Y|%G|%m|%d|%H|%M|%S|%L|%u|%V|%z|%Z)/g);i.adjustDate(a,c);for(var p=0,d=l.length;p<d;p++){var f,y=l[p],v=i.DATE_SYM_TABLE[y],g=h[y];f=o.isObject(v)?"timezone"===v.name?i.formatTimezone(c):"minuteOffset"===v.name?""+((c.hour<0?-1:1)*Math.abs(c.hour*i.MINUTES_PER_HOUR)+c.minute):null!=g?i.padDigits(g(e,a,r),v.padding):v:v,u=u.replace(y,f)}return u}},1976:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$dayOfMonth=void 0;var n=r(7408);t.$dayOfMonth=function(e,t,r){return n.computeDate(e,t,r).getUTCDate()}},4330:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$dayOfWeek=void 0;var n=r(7408);t.$dayOfWeek=function(e,t,r){return n.computeDate(e,t,r).getUTCDay()+1}},9877:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$dayOfYear=void 0;var n=r(7408);t.$dayOfYear=function(e,t,r){var o=n.computeDate(e,t,r),i=new Date(o.getUTCFullYear(),0,0),s=o.getTime()-i.getTime();return Math.round(s/n.MILLIS_PER_DAY)}},8994:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$hour=void 0;var n=r(7408);t.$hour=function(e,t,r){return n.computeDate(e,t,r).getUTCHours()}},1185:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7320),t),o(r(8593),t),o(r(4408),t),o(r(7021),t),o(r(1976),t),o(r(4330),t),o(r(9877),t),o(r(8994),t),o(r(7961),t),o(r(4938),t),o(r(3833),t),o(r(8715),t),o(r(8595),t),o(r(9631),t)},7961:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$millisecond=void 0;var n=r(7408);t.$millisecond=function(e,t,r){return n.computeDate(e,t,r).getUTCMilliseconds()}},4938:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$minute=void 0;var n=r(7408);t.$minute=function(e,t,r){return n.computeDate(e,t,r).getUTCMinutes()}},3833:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$month=void 0;var n=r(7408);t.$month=function(e,t,r){return n.computeDate(e,t,r).getUTCMonth()+1}},8715:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$second=void 0;var n=r(7408);t.$second=function(e,t,r){return n.computeDate(e,t,r).getUTCSeconds()}},8595:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$week=void 0;var n=r(7408);t.$week=function(e,t,r){var o=n.computeDate(e,t,r);(o=new Date(+o)).setUTCHours(0,0,0),o.setDate(o.getDate()+4-(o.getDay()||7));var i=new Date(o.getUTCFullYear(),0,1);return Math.floor(((o.getTime()-i.getTime())/864e5+1)/7)}},9631:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$year=void 0;var n=r(7408);t.$year=function(e,t,r){return n.computeDate(e,t,r).getUTCFullYear()}},8691:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(874),t),o(r(3244),t),o(r(6248),t),o(r(1521),t),o(r(5703),t),o(r(1185),t),o(r(2062),t),o(r(591),t),o(r(398),t),o(r(9960),t),o(r(4248),t),o(r(7648),t),o(r(9773),t)},2062:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$literal=void 0,t.$literal=function(e,t,r){return t}},591:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$objectToArray=t.$mergeObjects=void 0;var n=r(1455);Object.defineProperty(t,"$mergeObjects",{enumerable:!0,get:function(){return n.$mergeObjects}});var o=r(2105);Object.defineProperty(t,"$objectToArray",{enumerable:!0,get:function(){return o.$objectToArray}})},1455:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$mergeObjects=void 0;var n=r(8257),o=r(7045);t.$mergeObjects=function(e,t,r){var i=n.computeValue(e,t,null,r);return i instanceof Array?i.reduce((function(e,t){return o.into(e,t)}),{}):{}}},2105:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$objectToArray=void 0;var n=r(8257),o=r(7045);t.$objectToArray=function(e,t,r){var i=n.computeValue(e,t,null,r);o.assert(o.isObject(i),"$objectToArray expression must resolve to an object");for(var s=[],a=0,u=Object.entries(i);a<u.length;a++){var c=u[a],l=c[0],p=c[1];s.push({k:l,v:p})}return s}},6167:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$allElementsTrue=void 0;var n=r(8257),o=r(7045);t.$allElementsTrue=function(e,t,r){return n.computeValue(e,t,null,r)[0].every(o.truthy)}},4812:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$anyElementTrue=void 0;var n=r(8257),o=r(7045);t.$anyElementTrue=function(e,t,r){return n.computeValue(e,t,null,r)[0].some(o.truthy)}},398:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(6167),t),o(r(4812),t),o(r(5808),t),o(r(8590),t),o(r(62),t),o(r(1183),t),o(r(1857),t)},5808:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$setDifference=void 0;var n=r(8257),o=r(7045);t.$setDifference=function(e,t,r){var i=n.computeValue(e,t,null,r);return i[0].filter(o.notInArray.bind(null,i[1]))}},8590:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$setEquals=void 0;var n=r(8257),o=r(7045);t.$setEquals=function(e,t,r){var i=n.computeValue(e,t,null,r),s=o.unique(i[0],null==r?void 0:r.hashFunction),a=o.unique(i[1],null==r?void 0:r.hashFunction);return s.length===a.length&&s.length===o.intersection(s,a,null==r?void 0:r.hashFunction).length}},62:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$setIntersection=void 0;var n=r(8257),o=r(7045);t.$setIntersection=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.intersection(i[0],i[1],null==r?void 0:r.hashFunction)}},1183:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$setIsSubset=void 0;var n=r(8257),o=r(7045);t.$setIsSubset=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.intersection(i[0],i[1],null==r?void 0:r.hashFunction).length===i[0].length}},1857:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$setUnion=void 0;var n=r(8257),o=r(7045);t.$setUnion=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.union(i[0],i[1])}},6716:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.regexSearch=t.trimString=void 0;var n=r(8257),o=r(7045),i=[0,32,9,10,11,12,13,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202];t.trimString=function(e,t,r,s){var a=n.computeValue(e,t,null,r),u=a.input;if(o.isNil(u))return null;for(var c=o.isNil(a.chars)?i:a.chars.split("").map((function(e){return e.codePointAt(0)})),l=0,p=u.length-1;s.left&&l<=p&&-1!==c.indexOf(u[l].codePointAt(0));)l++;for(;s.right&&l<=p&&-1!==c.indexOf(u[p].codePointAt(0));)p--;return u.substring(l,p+1)},t.regexSearch=function(e,t,r,i){var s=n.computeValue(e,t,null,r);if(!o.isString(s.input))return[];var a=s.options;a&&(o.assert(-1===a.indexOf("x"),"extended capability option 'x' not supported"),o.assert(-1===a.indexOf("g"),"global option 'g' not supported"));for(var u,c=s.input,l=new RegExp(s.regex,a),p=[],d=0;u=l.exec(c);){for(var f={match:u[0],idx:u.index+d,captures:[]},y=1;y<u.length;y++)f.captures.push(u[y]||null);if(p.push(f),!i.global)break;d=u.index+u[0].length,c=c.substr(d)}return p}},5620:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$concat=void 0;var n=r(8257),o=r(7045);t.$concat=function(e,t,r){var i=n.computeValue(e,t,null,r);return[null,void 0].some(o.inArray.bind(null,i))?null:i.join("")}},9960:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(5620),t),o(r(9927),t),o(r(5512),t),o(r(9737),t),o(r(5440),t),o(r(6689),t),o(r(7494),t),o(r(9263),t),o(r(3592),t),o(r(3253),t),o(r(5513),t),o(r(1800),t),o(r(777),t),o(r(7800),t),o(r(4885),t),o(r(8990),t),o(r(5606),t)},9927:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$indexOfBytes=void 0;var n=r(8257),o=r(7045);t.$indexOfBytes=function(e,t,r){var i=n.computeValue(e,t,null,r),s="$indexOfBytes expression resolves to invalid an argument";if(o.isNil(i[0]))return null;o.assert(o.isString(i[0])&&o.isString(i[1]),s);var a=i[0],u=i[1],c=i[2],l=i[3],p=o.isNil(c)||o.isNumber(c)&&c>=0&&Math.round(c)===c;if(p=p&&(o.isNil(l)||o.isNumber(l)&&l>=0&&Math.round(l)===l),o.assert(p,s),(c=c||0)>(l=l||a.length))return-1;var d=a.substring(c,l).indexOf(u);return d>-1?d+c:d}},5512:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$ltrim=void 0;var n=r(6716);t.$ltrim=function(e,t,r){return n.trimString(e,t,r,{left:!0,right:!1})}},9737:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$regexFind=void 0;var n=r(6716);t.$regexFind=function(e,t,r){var o=n.regexSearch(e,t,r,{global:!1});return 0===o.length?null:o[0]}},5440:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$regexFindAll=void 0;var n=r(6716);t.$regexFindAll=function(e,t,r){return n.regexSearch(e,t,r,{global:!0})}},6689:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$regexMatch=void 0;var n=r(6716);t.$regexMatch=function(e,t,r){return 0!=n.regexSearch(e,t,r,{global:!1}).length}},7494:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$rtrim=void 0;var n=r(6716);t.$rtrim=function(e,t,r){return n.trimString(e,t,r,{left:!1,right:!0})}},9263:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$split=void 0;var n=r(8257),o=r(7045);t.$split=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i[0])?null:(o.assert(i.every(o.isString),"$split expression must result to array(2) of strings"),i[0].split(i[1]))}},3253:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$strLenBytes=void 0;var n=r(8257);t.$strLenBytes=function(e,t,r){return~-encodeURI(n.computeValue(e,t,null,r)).split(/%..|./).length}},5513:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$strLenCP=void 0;var n=r(8257);t.$strLenCP=function(e,t,r){return n.computeValue(e,t,null,r).length}},3592:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$strcasecmp=void 0;var n=r(8257),o=r(7045);t.$strcasecmp=function(e,t,r){var i=n.computeValue(e,t,null,r),s=i[0],a=i[1];return o.isEqual(s,a)||i.every(o.isNil)?0:(o.assert(i.every(o.isString),"$strcasecmp must resolve to array(2) of strings"),((s=s.toUpperCase())>(a=a.toUpperCase())?1:s<a&&-1)||0)}},1800:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$substr=void 0;var n=r(8257),o=r(7045);t.$substr=function(e,t,r){var i=n.computeValue(e,t,null,r),s=i[0],a=i[1],u=i[2];return o.isString(s)?a<0?"":u<0?s.substr(a):s.substr(a,u):""}},777:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$substrBytes=void 0;var n=r(8257),o=r(7045),i=[192,224,240];function s(e){if(e<128)return[e];for(var t=(e<2048?1:e<65536&&2)||3,r=[(e>>6*t)+i[t-1]];t>0;)r.push(128|e>>6*--t&63);return r}t.$substrBytes=function(e,t,r){var i=n.computeValue(e,t,null,r),a=i[0],u=i[1],c=i[2];o.assert(o.isString(a)&&o.isNumber(u)&&u>=0&&o.isNumber(c)&&c>=0,"$substrBytes: invalid arguments");for(var l=function(e){for(var t=[],r=0,n=e.length;r<n;r++)t.push(s(e.codePointAt(r)));return t}(a),p=[],d=0,f=0;f<l.length;f++)p.push(d),d+=l[f].length;var y=p.indexOf(u),h=p.indexOf(u+c);return o.assert(y>-1&&h>-1,"$substrBytes: invalid range, start or end index is a UTF-8 continuation byte."),a.substring(y,h)}},7800:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$substrCP=void 0;var n=r(1800);t.$substrCP=function(e,t,r){return n.$substr(e,t,r)}},4885:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toLower=void 0;var n=r(8257),o=r(7045);t.$toLower=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isEmpty(i)?"":i.toLowerCase()}},8990:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toUpper=void 0;var n=r(8257),o=r(7045);t.$toUpper=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isEmpty(i)?"":i.toUpperCase()}},5606:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$trim=void 0;var n=r(6716);t.$trim=function(e,t,r){return n.trimString(e,t,r,{left:!0,right:!0})}},4248:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$radiansToDegrees=t.$degreesToRadians=t.$atanh=t.$acosh=t.$asinh=t.$atan2=t.$atan=t.$acos=t.$asin=t.$tan=t.$cos=t.$sin=void 0;var n=r(8257),o=r(7045);function i(e,t){return function(r,i,s){var a=n.computeValue(r,i,null,s);if(isNaN(a)||o.isNil(a))return a;if(a===1/0||a===-1/0){if(t)return a;throw new Error("cannot apply $"+e.name+" to -inf, value must in (-inf,inf)")}return e(a)}}t.$sin=i(Math.sin),t.$cos=i(Math.cos),t.$tan=i(Math.tan),t.$asin=i(Math.asin),t.$acos=i(Math.acos),t.$atan=i(Math.atan),t.$atan2=function(e,t,r){var i=n.computeValue(e,t,null,r),s=i[0],a=i[1];return isNaN(s)||o.isNil(s)?s:isNaN(a)||o.isNil(a)?a:Math.atan2(s,a)},t.$asinh=i(Math.asinh),t.$acosh=i(Math.acosh),t.$atanh=i(Math.atanh);var s=Math.PI/180;t.$degreesToRadians=i((function(e){return e*s}),!0);var a=180/Math.PI;t.$radiansToDegrees=i((function(e){return e*a}),!0)},2659:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.toInteger=t.TypeConvertError=void 0;var i=r(8257),s=r(7045),a=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t}(Error);t.TypeConvertError=a,t.toInteger=function(e,t,r,n,o,u){var c=i.computeValue(e,t,null,r);if(s.isNil(c))return null;if(c instanceof Date)return c.getTime();if(!0===c)return 1;if(!1===c)return 0;var l=Number(c);if(s.isNumber(l)&&l>=o&&l<=n&&(!s.isString(c)||-1===l.toString().indexOf(".")))return Math.trunc(l);throw new a("cannot convert '"+c+"' to "+u)}},2135:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$convert=void 0;var n=r(8257),o=r(7045),i=r(2659),s=r(5554),a=r(2080),u=r(2317),c=r(3417),l=r(9179),p=r(1334);t.$convert=function(e,t,r){var d=n.computeValue(e,t,null,r);if(d.onNull=void 0===d.onNull?null:d.onNull,o.isNil(d.input))return d.onNull;try{switch(d.to){case 2:case o.JsType.STRING:return p.$toString(e,d.input,r);case 8:case o.JsType.BOOLEAN:case o.BsonType.BOOL:return s.$toBool(e,d.input,r);case 9:case o.JsType.DATE:return a.$toDate(e,d.input,r);case 1:case 19:case o.BsonType.DOUBLE:case o.BsonType.DECIMAL:case o.JsType.NUMBER:return u.$toDouble(e,d.input,r);case 16:case o.BsonType.INT:return c.$toInt(e,d.input,r);case 18:case o.BsonType.LONG:return l.$toLong(e,d.input,r)}}catch(e){}if(void 0!==d.onError)return d.onError;throw new i.TypeConvertError("could not convert to type "+d.to+".")}},7648:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(2135),t),o(r(2417),t),o(r(5554),t),o(r(2080),t),o(r(2075),t),o(r(2317),t),o(r(3417),t),o(r(9179),t),o(r(1334),t),o(r(9714),t)},2417:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$isNumber=void 0;var n=r(8257),o=r(7045);t.$isNumber=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNumber(i)}},5554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toBool=void 0;var n=r(8257),o=r(7045);t.$toBool=function(e,t,r){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:!!o.isString(i)||Boolean(i)}},2080:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toDate=void 0;var n=r(8257),o=r(7045),i=r(2659);t.$toDate=function(e,t,r){var s=n.computeValue(e,t,null,r);if(s instanceof Date)return s;if(o.isNil(s))return null;var a=new Date(s),u=a.getTime();if(!isNaN(u))return a;throw new i.TypeConvertError("cannot convert '"+s+"' to date")}},2075:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toDecimal=void 0;var n=r(2317);t.$toDecimal=n.$toDouble},2317:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toDouble=void 0;var n=r(8257),o=r(7045),i=r(2659);t.$toDouble=function(e,t,r){var s=n.computeValue(e,t,null,r);if(o.isNil(s))return null;if(s instanceof Date)return s.getTime();if(!0===s)return 1;if(!1===s)return 0;var a=Number(s);if(o.isNumber(a))return a;throw new i.TypeConvertError("cannot convert '"+s+"' to double/decimal")}},3417:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toInt=void 0;var n=r(7045),o=r(2659);t.$toInt=function(e,t,r){return o.toInteger(e,t,r,n.MAX_INT,n.MIN_INT,"int")}},9179:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toLong=void 0;var n=r(7045),o=r(2659);t.$toLong=function(e,t,r){return o.toInteger(e,t,r,n.MAX_LONG,n.MIN_LONG,"long")}},1334:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$toString=void 0;var n=r(8257),o=r(7045),i=r(1185);t.$toString=function(e,t,r){var s=n.computeValue(e,t,null,r);if(o.isNil(s))return null;if(s instanceof Date){var a={date:t,format:"%Y-%m-%dT%H:%M:%S.%LZ"};return i.$dateToString(e,a,r)}return s.toString()}},9714:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$type=void 0;var n=r(8257),o=r(7045);t.$type=function(e,t,r){var i=n.computeValue(e,t,null,r),s=o.getType(i),a=s.toLowerCase();switch(a){case o.JsType.BOOLEAN:return o.BsonType.BOOL;case o.JsType.NUMBER:return i.toString().indexOf(".")>=0?o.BsonType.DOUBLE:i>=o.MIN_INT&&i<=o.MAX_INT?o.BsonType.INT:o.BsonType.LONG;case o.JsType.REGEXP:return o.BsonType.REGEX;case o.JsType.STRING:case o.JsType.DATE:case o.JsType.ARRAY:case o.JsType.OBJECT:case o.JsType.FUNCTION:case o.JsType.NULL:case o.JsType.UNDEFINED:return a;default:return s}}},9773:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(6801),t)},6801:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$let=void 0;var n=r(8257);t.$let=function(e,t,r){for(var o=0,i=Object.entries(t.vars);o<i.length;o++){var s=i[o],a=s[0],u=s[1],c=n.computeValue(e,u,null,r);e["$"+a]=c}return n.computeValue(e,t.in,null,r)}},3871:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$addFields=void 0;var n=r(8257),o=r(7045);t.$addFields=function(e,t,r){var i=Object.keys(t);return 0===i.length?e:e.map((function(e){for(var s=o.cloneDeep(e),a=0,u=i;a<u.length;a++){var c=u[a],l=n.computeValue(e,t[c],null,r);void 0!==l?o.setValue(s,c,l):o.removeValue(s,c)}return s}))}},3263:function(e,t,r){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.$bucket=void 0;var o=r(8257),i=r(2439),s=r(7045);t.$bucket=function(e,t,r){var a=n(t.boundaries),u=t.default,c=a[0],l=a[a.length-1],p=t.output||{count:{$sum:1}};s.assert(t.boundaries.length>2,"$bucket 'boundaries' expression must have at least 3 elements");for(var d=s.getType(c),f=0,y=a.length-1;f<y;f++)s.assert(d===s.getType(a[f+1]),"$bucket 'boundaries' must all be of the same type"),s.assert(a[f]<a[f+1],"$bucket 'boundaries' must be sorted in ascending order");!s.isNil(u)&&s.getType(t.default)===s.getType(c)&&s.assert(t.default>=l||t.default<c,"$bucket 'default' expression must be out of boundaries range");for(var h={},v=0,g=a;v<g.length;v++){var m=g[v];h[m]=[]}s.isNil(u)||(h[u]=[]);var b=null;return i.Lazy((function(){return null===b&&(e.each((function(e){var n=o.computeValue(e,t.groupBy,null,r);if(s.isNil(n)||n<c||n>=l)s.assert(!s.isNil(u),"$bucket require a default for out of range values"),h[u].push(e);else{s.assert(n>=c&&n<l,"$bucket 'groupBy' expression must resolve to a value in range of boundaries");var i=function(e,t){for(var r=0,n=e.length-1;r<=n;){var o=Math.round(r+(n-r)/2);if(t<e[o])n=o-1;else{if(!(t>e[o]))return o;r=o+1}}return r}(a,n),p=a[Math.max(0,i-1)];h[p].push(e)}})),a.pop(),s.isNil(u)||a.push(u),b=i.Lazy(a).map((function(e){var t=o.computeValue(h[e],p,null,r);return s.into(t,{_id:e})}))),b.next()}))}},427:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$bucketAuto=void 0;var n=r(8257),o=r(7045);t.$bucketAuto=function(e,t,r){var i=t.output||{count:{$sum:1}},s=t.groupBy,a=t.buckets;return o.assert(a>0,"The $bucketAuto 'buckets' field must be greater than 0, but found: "+a),e.transform((function(e){for(var t=Math.max(1,Math.round(e.length/a)),u=o.memoize(n.computeValue,null==r?void 0:r.hashFunction),c={},l=[],p=o.sortBy(e,(function(e){var t=u(e,s,null,r);return o.isNil(t)?l.push(e):(c[t]||(c[t]=[]),c[t].push(e)),t})),d=[],f=0,y=0,h=p.length;y<a&&f<h;y++){for(var v={},g=[],m=0;m<t&&f<h;m++){var b=u(p[f],s,null,r);o.isNil(b)&&(b=null),o.into(g,o.isNil(b)?l:c[b]),f+=o.isNil(b)?l.length:c[b].length,o.has(v,"min")||(v.min=b),d.length>0&&(d[d.length-1]._id.max=v.min)}y==a-1&&o.into(g,p.slice(f));var O=n.computeValue(g,i,null,r);d.push(o.into(O,{_id:v}))}return d.length>0&&(d[d.length-1]._id.max=u(p[p.length-1],s,null,r)),d}))}},4392:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$count=void 0;var n=r(2439),o=r(7045);t.$count=function(e,t,r){return o.assert(o.isString(t)&&""!==t.trim()&&-1===t.indexOf(".")&&"$"!==t.trim()[0],"Invalid expression value for $count"),n.Lazy((function(){var r={};return r[t]=e.size(),{value:r,done:!1}})).first()}},4947:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$facet=void 0;var n=r(4793),o=r(7045);t.$facet=function(e,t,r){return e.transform((function(e){return[o.objectMap(t,(function(t){return new n.Aggregator(t,r).run(e)}))]}))}},1001:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$group=void 0;var n=r(8257),o=r(7045);t.$group=function(e,t,r){var i=t._id;return e.transform((function(e){var s=o.groupBy(e,(function(e){return n.computeValue(e,i,null,r)}),null==r?void 0:r.hashFunction);delete(t=o.into({},t))._id;var a=-1,u=s.keys.length;return function(){if(++a===u)return{done:!0};var e=s.keys[a],o={};void 0!==e&&(o._id=e);for(var i=0,c=Object.entries(t);i<c.length;i++){var l=c[i],p=l[0],d=l[1];o[p]=n.computeValue(s.groups[a],d,p,r)}return{value:o,done:!1}}}))}},397:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(3871),t),o(r(3263),t),o(r(427),t),o(r(4392),t),o(r(4947),t),o(r(1001),t),o(r(3258),t),o(r(8961),t),o(r(8937),t),o(r(5790),t),o(r(4402),t),o(r(3214),t),o(r(77),t),o(r(6661),t),o(r(3026),t),o(r(9950),t),o(r(4316),t),o(r(8015),t),o(r(5761),t),o(r(99),t),o(r(7913),t)},3258:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$limit=void 0,t.$limit=function(e,t,r){return e.take(t)}},8961:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$lookup=void 0;var n=r(7045);t.$lookup=function(e,t,r){var o=n.isString(t.from)?null==r?void 0:r.collectionResolver(t.from):t.from;n.assert(o instanceof Array,"'from' field must resolve to an array");for(var i={},s=0,a=o;s<a.length;s++){var u=a[s],c=n.hashCode(n.resolve(u,t.foreignField),null==r?void 0:r.hashFunction);i[c]=i[c]||[],i[c].push(u)}return e.map((function(e){var o=n.hashCode(n.resolve(e,t.localField),null==r?void 0:r.hashFunction),s=n.into({},e);return s[t.as]=i[o]||[],s}))}},8937:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$match=void 0;var n=r(7054);t.$match=function(e,t,r){var o=new n.Query(t,r);return e.filter((function(e){return o.test(e)}))}},5790:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$out=void 0;var n=r(7045);t.$out=function(e,t,r){var o=n.isString(t)?null==r?void 0:r.collectionResolver(t):t;return n.assert(o instanceof Array,"expression must resolve to an array"),e.map((function(e){return o.push(e),e}))}},4402:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$project=void 0;var n=r(8257),o=r(7045);function i(e,t,r,a,u){var c={},l=!1,p=!1,d=[];u&&d.push(r.idKey);for(var f=function(a){var u=void 0,f=t[a];if(a!==r.idKey&&o.inArray([0,!1],f)&&(p=!0),a===r.idKey&&o.isEmpty(f))u=e[a];else if(o.isString(f))u=n.computeValue(e,f,a,r);else if(o.inArray([1,!0],f));else if(f instanceof Array)u=f.map((function(t){var i=n.computeValue(e,t,null,r);return o.isNil(i)?null:i}));else{if(!o.isObject(f))return d.push(a),"continue";var y=f,h=Object.keys(f),v=1==h.length?h[0]:null,g=n.getOperator(n.OperatorType.PROJECTION,v);if(g)"$slice"===v?o.ensureArray(y[v]).every(o.isNumber)?(u=g(e,y[v],a),l=!0):u=n.computeValue(e,y,a,r):u=g(e,y[v],a,r);else if(o.isOperator(v))u=n.computeValue(e,y[v],v,r);else if(o.has(e,a)){s(y,r);var m=e[a];u=m instanceof Array?m.map((function(e){return i(e,y,r,h,!1)})):i(m=o.isObject(m)?m:e,y,r,h,!1)}else u=n.computeValue(e,f,null,r)}var b=o.resolveGraph(e,a,{preserveMissing:!0});void 0!==b&&o.merge(c,b,{flatten:!0}),o.notInArray([0,1,!1,!0],f)&&(void 0===u?o.removeValue(c,a):o.setValue(c,a,u))},y=0,h=a;y<h.length;y++)f(h[y]);if(o.filterMissing(c),(l||p||u)&&(c=o.into({},e,c),d.length>0)){c=o.cloneDeep(c);for(var v=0,g=d;v<g.length;v++){var m=g[v];o.removeValue(c,m)}}return c}function s(e,t){for(var r=[!1,!1],n=0,i=Object.entries(e);n<i.length;n++){var s=i[n],a=s[0],u=s[1];if(a===t.idKey)return;0===u||!1===u?r[0]=!0:1!==u&&!0!==u||(r[1]=!0),o.assert(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}t.$project=function(e,t,r){if(o.isEmpty(t))return e;var n=Object.keys(t),a=!1;s(t,r);var u=r.idKey;if(o.inArray(n,u)){var c=t[u];0!==c&&!1!==c||(n=n.filter(o.notInArray.bind(null,[u])),a=0==n.length)}else n.push(u);return e.map((function(e){return i(e,t,r,n,a)}))}},3214:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$redact=void 0;var n=r(8257),o=r(7045);t.$redact=function(e,t,r){return e.map((function(e){return n.redact(o.cloneDeep(e),t,r)}))}},77:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$replaceRoot=void 0;var n=r(8257),o=r(7045);t.$replaceRoot=function(e,t,r){return e.map((function(e){return e=n.computeValue(e,t.newRoot,null,r),o.assert(o.isObject(e),"$replaceRoot expression must return an object"),e}))}},6661:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$replaceWith=void 0;var n=r(77);t.$replaceWith=n.$replaceRoot},3026:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sample=void 0,t.$sample=function(e,t,r){return e.transform((function(e){var r=e.length,n=-1;return function(){if(++n===t.size)return{done:!0};var o=Math.floor(Math.random()*r);return{value:e[o],done:!1}}}))}},9950:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$set=void 0;var n=r(3871);t.$set=n.$addFields},4316:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$skip=void 0,t.$skip=function(e,t,r){return e.drop(t)}},8015:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sort=void 0;var n=r(7045);t.$sort=function(e,t,r){if(n.isEmpty(t)||!n.isObject(t))return e;var i=n.compare,s=r.collation;return n.isObject(s)&&n.isString(s.locale)&&(i=function(e){var t={sensitivity:o[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));var r=new Intl.Collator(e.locale,t);return function(e,t){if(!n.isString(e)||!n.isString(t))return n.compare(e,t);var o=r.compare(e,t);return o<0?-1:o>0?1:0}}(s)),e.transform((function(e){for(var o=function(o){var s=n.groupBy(e,(function(e){return n.resolve(e,o)}),null==r?void 0:r.hashFunction),a={},u=n.sortBy(s.keys,(function(e,t){return a[e]=t,e}),i);-1===t[o]&&u.reverse(),e=[];for(var c=0,l=u;c<l.length;c++){var p=l[c];n.into(e,s.groups[a[p]])}},s=0,a=Object.keys(t).reverse();s<a.length;s++)o(a[s]);return e}))};var o={1:"base",2:"accent",3:"variant"}},5761:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$sortByCount=void 0;var n=r(1001),o=r(8015);t.$sortByCount=function(e,t,r){var i={count:{$sum:1}};return i._id=t,o.$sort(n.$group(e,i,r),{count:-1},r)}},99:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$unset=void 0;var n=r(7045),o=r(4402);t.$unset=function(e,t,r){for(var i={},s=0,a=t=n.ensureArray(t);s<a.length;s++)i[a[s]]=0;return o.$project(e,i,r)}},7913:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$unwind=void 0;var n=r(2439),o=r(7045);t.$unwind=function(e,t,r){o.isString(t)&&(t={path:t});var i,s=t.path.substr(1),a=(null==t?void 0:t.includeArrayIndex)||!1,u=t.preserveNullAndEmptyArrays||!1,c=function(e,t){return!1!==a&&(e[a]=t),e};return n.Lazy((function(){for(var t=function(){if(i instanceof n.Iterator&&!(a=i.next()).done)return{value:a};var t=e.next();if(t.done)return{value:t};var r=t.value;if((i=o.resolve(r,s))instanceof Array){if(0===i.length&&!0===u){i=null;var a=o.cloneDeep(r);return o.removeValue(a,s),{value:{value:c(a,null),done:!1}}}i=n.Lazy(i).map((function(e,t){var n=o.cloneDeep(r);return o.setValue(n,s,e),c(n,t)}))}else if(!o.isEmpty(i)||!0===u)return a=o.cloneDeep(r),{value:{value:c(a,null),done:!1}}};;){var r=t();if("object"==typeof r)return r.value}}))}},9575:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$elemMatch=void 0;var n=r(7054),o=r(7045);t.$elemMatch=function(e,t,r,i){var s=o.resolve(e,r),a=new n.Query(t,i);o.assert(s instanceof Array,"$elemMatch: argument must resolve to array");for(var u=0;u<s.length;u++)if(a.test(s[u]))return[s[u]]}},2148:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(9575),t),o(r(2064),t)},2064:function(e,t,r){var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.$slice=void 0;var o=r(7045),i=r(625);t.$slice=function(e,t,r,s){var a=o.resolve(e,r),u=t;return o.isArray(a)?i.$slice(e,t instanceof Array?n([a],u):[a,t],s):a}},9725:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$all=void 0;var n=r(2408);t.$all=n.createQueryOperator(n.$all)},3834:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$elemMatch=void 0;var n=r(2408);t.$elemMatch=n.createQueryOperator(n.$elemMatch)},6592:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(9725),t),o(r(3834),t),o(r(9287),t)},9287:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$size=void 0;var n=r(2408);t.$size=n.createQueryOperator(n.$size)},7568:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$nin=t.$ne=t.$lte=t.$lt=t.$in=t.$gte=t.$gt=t.$eq=void 0;var n=r(2408);t.$eq=n.createQueryOperator(n.$eq),t.$gt=n.createQueryOperator(n.$gt),t.$gte=n.createQueryOperator(n.$gte),t.$in=n.createQueryOperator(n.$in),t.$lt=n.createQueryOperator(n.$lt),t.$lte=n.createQueryOperator(n.$lte),t.$ne=n.createQueryOperator(n.$ne),t.$nin=n.createQueryOperator(n.$nin)},785:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$exists=void 0;var n=r(2408);t.$exists=n.createQueryOperator(n.$exists)},5021:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(785),t),o(r(447),t)},447:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$type=void 0;var n=r(2408);t.$type=n.createQueryOperator(n.$type)},3520:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$expr=void 0;var n=r(8257);t.$expr=function(e,t,r){return function(e){return n.computeValue(e,t,null,r)}}},3110:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(3520),t),o(r(7861),t),o(r(5524),t)},7861:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$mod=void 0;var n=r(2408);t.$mod=n.createQueryOperator(n.$mod)},5524:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$regex=void 0;var n=r(2408);t.$regex=n.createQueryOperator(n.$regex)},541:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(6592),t),o(r(7568),t),o(r(5021),t),o(r(3110),t),o(r(4461),t)},1619:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$and=void 0;var n=r(7054),o=r(7045);t.$and=function(e,t,r){o.assert(o.isArray(t),"Invalid expression: $and expects value to be an Array");var i=new Array;return t.forEach((function(e){return i.push(new n.Query(e,r))})),function(e){for(var t=0;t<i.length;t++)if(!i[t].test(e))return!1;return!0}}},4461:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(1619),t),o(r(9830),t),o(r(3603),t),o(r(9784),t)},9830:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$nor=void 0;var n=r(7045),o=r(9784);t.$nor=function(e,t,r){n.assert(n.isArray(t),"Invalid expression. $nor expects value to be an Array");var i=o.$or("$or",t,r);return function(e){return!i(e)}}},3603:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$not=void 0;var n=r(7054),o=r(7045);t.$not=function(e,t,r){var i={};i[e]=o.normalize(t);var s=new n.Query(i,r);return function(e){return!s.test(e)}}},9784:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$or=void 0;var n=r(7054),o=r(7045);t.$or=function(e,t,r){o.assert(o.isArray(t),"Invalid expression. $or expects value to be an Array");var i=t.map((function(e){return new n.Query(e,r)}));return function(e){for(var t=0;t<i.length;t++)if(i[t].test(e))return!0;return!1}}},7054:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var n=r(8257),o=r(7336),i=r(7045),s=function(){function e(e,t){this.__criteria=e,this.__options=n.makeOptions(t),this.__compiled=[],this._compile()}return e.prototype._compile=function(){var e;i.assert(i.isObject(this.__criteria),"query criteria must be an object");for(var t=0,r=Object.entries(this.__criteria);t<r.length;t++){var n=r[t],o=n[0],s=n[1];if("$where"===o)e={field:o,expr:s};else if("$expr"===o)this._processOperator(o,o,s);else if(i.inArray(["$and","$or","$nor"],o))this._processOperator(o,o,s);else{i.assert(!i.isOperator(o),"unknown top level operator: "+o);for(var a=0,u=Object.entries(i.normalize(s));a<u.length;a++){var c=u[a],l=c[0],p=c[1];this._processOperator(o,l,p)}}i.isObject(e)&&this._processOperator(e.field,e.field,e.expr)}},e.prototype._processOperator=function(e,t,r){var o=n.getOperator(n.OperatorType.QUERY,t);i.assert(!!o,"unknown operator "+t);var s=o(e,r,this.__options);this.__compiled.push(s)},e.prototype.test=function(e){for(var t=0,r=this.__compiled.length;t<r;t++)if(!this.__compiled[t](e))return!1;return!0},e.prototype.find=function(e,t){var r=this;return new o.Cursor(e,(function(e){return r.test(e)}),t||{},this.__options)},e.prototype.remove=function(e){var t=this;return e.reduce((function(e,r){return t.test(r)||e.push(r),e}),[])},e}();t.Query=s},7045:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=t.isOperator=t.removeValue=t.setValue=t.traverse=t.filterMissing=t.resolveGraph=t.resolve=t.memoize=t.into=t.groupBy=t.sortBy=t.compare=t.hashCode=t.unique=t.isEqual=t.flatten=t.union=t.intersection=t.merge=t.objectMap=t.has=t.ensureArray=t.isEmpty=t.truthy=t.notInArray=t.inArray=t.isUndefined=t.isNull=t.isNil=t.isFunction=t.isRegExp=t.isDate=t.isObjectLike=t.isObject=t.isArray=t.isNumber=t.isString=t.isBoolean=t.getType=t.cloneDeep=t.assert=t.BsonType=t.JsType=t.MIN_LONG=t.MAX_LONG=t.MIN_INT=t.MAX_INT=void 0,t.MAX_INT=2147483647,t.MIN_INT=-2147483648,t.MAX_LONG=Number.MAX_SAFE_INTEGER,t.MIN_LONG=Number.MIN_SAFE_INTEGER;var r,n,o={},i=function(e){for(var t=b(e),r=0,n=t.length;n;)r=(r<<5)-r^t.charCodeAt(--n);return(r>>>0).toString()};!function(e){e.NULL="null",e.UNDEFINED="undefined",e.BOOLEAN="boolean",e.NUMBER="number",e.STRING="string",e.DATE="date",e.REGEXP="regexp",e.ARRAY="array",e.OBJECT="object",e.FUNCTION="function"}(r=t.JsType||(t.JsType={})),(n=t.BsonType||(t.BsonType={})).BOOL="bool",n.INT="int",n.LONG="long",n.DOUBLE="double",n.DECIMAL="decimal",n.REGEX="regex";var s=[r.NULL,r.UNDEFINED,r.BOOLEAN,r.NUMBER,r.STRING,r.DATE,r.REGEXP],a=Object.getPrototypeOf({}),u=/^\[object ([a-zA-Z0-9]+)\]$/;function c(e){return u.exec(Object.prototype.toString.call(e))[1]}function l(e){return typeof e===r.STRING}function p(e){if(!e)return!1;var t=Object.getPrototypeOf(e);return(t===a||null===t)&&"[object Object]"===Object.prototype.toString.call(e)}function d(e){return e===Object(e)}function f(e){return e instanceof RegExp}function y(e){return null==e}function h(e,r){return!t.inArray(e,r)}function v(e){return y(e)||l(e)&&!e||e instanceof Array&&0===e.length||p(e)&&0===Object.keys(e).length}function g(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}function m(e,t){for(var r={},n=Object.keys(e),o=0;o<n.length;o++){var i=n[o];r[i]=t(e[i],i)}return r}function b(e){var t=c(e).toLowerCase();switch(t){case r.BOOLEAN:case r.NUMBER:case r.REGEXP:return e.toString();case r.STRING:return JSON.stringify(e);case r.DATE:return e.toISOString();case r.NULL:case r.UNDEFINED:return t;case r.ARRAY:return"["+e.map(b).join(",")+"]"}var n=t===r.OBJECT?"":""+c(e),o=Object.keys(e);return o.sort(),n+"{"+o.map((function(t){return b(t)+":"+b(e[t])})).join(",")+"}"}function O(e,t){return void 0===t&&(t=i),y(e)?null:t(e)}function _(e,t){return e<t?-1:e>t?1:0}t.assert=function(e,t){if(!e)throw new Error(t)},t.cloneDeep=function e(t){return t instanceof Array?t.map(e):t instanceof Date?new Date(t):p(t)?m(t,e):t},t.getType=c,t.isBoolean=function(e){return typeof e===r.BOOLEAN},t.isString=l,t.isNumber=function(e){return!isNaN(e)&&typeof e===r.NUMBER},t.isArray=Array.isArray||function(e){return e instanceof Array},t.isObject=p,t.isObjectLike=d,t.isDate=function(e){return e instanceof Date},t.isRegExp=f,t.isFunction=function(e){return typeof e===r.FUNCTION},t.isNil=y,t.isNull=function(e){return null===e},t.isUndefined=function(e){return void 0===e},t.inArray=Array.prototype.includes?function(e,t){return e.includes(t)}:function(e,t){return isNaN(t)&&!l(t)?e.some((function(e){return isNaN(e)&&!l(e)})):e.indexOf(t)>-1},t.notInArray=h,t.truthy=function(e){return!!e},t.isEmpty=v,t.ensureArray=function(e){return e instanceof Array?e:[e]},t.has=g,t.objectMap=m,t.merge=function e(r,n,i){if(r===o)return n;if(n===o)return r;var s=[r,n];if(!s.every(p)&&!s.every(t.isArray))throw Error("mismatched types. must both be array or object");if(i=i||{flatten:!1},t.isArray(r)){var a=r,u=n;if(i.flatten){for(var c=0,l=0;c<a.length&&l<u.length;)a[c]=e(a[c++],u[l++],i);for(;l<u.length;)a.push(n[l++])}else Array.prototype.push.apply(a,u)}else Object.keys(n).forEach((function(t){g(r,t)?r[t]=e(r[t],n[t],i):r[t]=n[t]}));return r},t.intersection=function(e,t,r){var n=!1;if(e.length>t.length){var o=e;e=t,t=o,n=!0}for(var i=Math.max(e.length,t.length),s=Math.min(e.length,t.length),a=e.reduce((function(e,t,n){return e[O(t,r)]=n,e}),{}),u=new Array,c=0,l=0;c<i&&l<s;c++){var p=a[O(t[c],r)];void 0!==p&&(u.push(p),l++)}return n||u.sort(),u.map((function(t){return e[t]}))},t.union=function(e,t){var r=[],n=t.filter(h.bind(null,e));return $(r,e),$(r,n),r},t.flatten=function(e,r){var n=[];return function e(r,o){for(var i=0,s=r.length;i<s;i++)t.isArray(r[i])&&(o>0||o<0)?e(r[i],Math.max(-1,o-1)):n.push(r[i])}(e,r),n},t.isEqual=function(e,t){for(var n=[e],o=[t];n.length>0;)if((e=n.pop())!==(t=o.pop())){var i=c(e).toLowerCase();if(i!==c(t).toLowerCase()||i===r.FUNCTION)return!1;if(i===r.ARRAY){var s=e,a=t;if(s.length!==a.length)return!1;if(s.length===a.length&&0===s.length)continue;$(n,s),$(o,a)}else if(i===r.OBJECT){var u=Object.keys(e),l=Object.keys(t);if(u.length!==l.length)return!1;u.sort(),l.sort();for(var p=0,d=u.length;p<d;p++){var f=u[p];if(f!==l[p])return!1;n.push(e[f]),o.push(t[f])}}else if(b(e)!==b(t))return!1}return 0===n.length},t.unique=function(e,t){for(var r={},n=[],o=0,i=e;o<i.length;o++){var s=i[o],a=O(s,t);g(r,a)||(n.push(s),r[a]=0)}return n},t.hashCode=O,t.compare=_,t.sortBy=function(e,t,r){var n=new Array,o=new Array,i={};if(r=r||_,v(e))return e;for(var s=0;s<e.length;s++){var a=e[s],u=t(a,s);y(u)?o.push(a):(l(u)&&(u+="\0"),i[u]?i[u].push(a):i[u]=[a],n.push(u))}for(n.sort(r),s=0;s<n.length;s++)$(o,i[n[s]]);return o},t.groupBy=function(e,t,r){for(var n={keys:new Array,groups:new Array},o={},i=0,s=e;i<s.length;i++){var a=s[i],u=t(a),c=O(u,r),l=-1;void 0===o[c]&&(l=n.keys.length,o[c]=l,n.keys.push(u),n.groups.push([])),l=o[c],n.groups[l].push(a)}return n};var M=5e4;function $(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e instanceof Array?t.reduce((function(e,t){for(var r=Math.ceil(t.length/M),n=0;r-- >0;)Array.prototype.push.apply(e,t.slice(n,n+M)),n+=M;return e}),e):p(e)?t.filter(d).reduce((function(e,t){return Object.assign(e,t),e}),e):null}function j(e,t){return d(e)?e[t]:void 0}function w(e,t,r,n){var o=t.split("."),i=o[0],s=o.slice(1).join(".");1===o.length?r(e,i):(!0===n&&y(e[i])&&(e[i]={}),w(e[i],s,r,n))}t.into=$,t.memoize=function(e,t){var r,n=this;return r={},function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var s=O(o,t);return g(r,s)||(r[s]=e.apply(n,o)),r[s]}},t.resolve=function(e,r,n){var o=0;n=n||{unwrapArray:!1};var i=t.inArray(s,c(e).toLowerCase())?e:function e(t,r){for(var n=t,i=function(t){var i=r[t];if(null===/^\d+$/.exec(i)&&n instanceof Array){if(0===t&&o>0)return"break";o+=1;var s=r.slice(t);return n=n.reduce((function(t,r){var n=e(r,s);return void 0!==n&&t.push(n),t}),[]),"break"}if(void 0===(n=j(n,i)))return"break"},s=0;s<r.length&&"break"!==i(s);s++);return n}(e,r.split("."));return i instanceof Array&&n.unwrapArray?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(i,o):i},t.resolveGraph=function e(t,r,n){void 0===n&&(n={preserveMissing:!1});var i,s,a=r.split("."),u=a[0],c=a.slice(1).join("."),l=null!==/^\d+$/.exec(u),p=a.length>1;if(t instanceof Array)if(l)i=j(t,Number(u)),p&&(i=e(i,c,n)),i=[i];else{i=[];for(var d=0,f=t;d<f.length;d++)s=e(f[d],r,n),n.preserveMissing?(void 0===s&&(s=o),i.push(s)):void 0!==s&&i.push(s)}else{if(s=j(t,u),p&&(s=e(s,c,n)),void 0===s)return;(i={})[u]=s}return i},t.filterMissing=function e(t){if(t instanceof Array)for(var r=t.length-1;r>=0;r--)t[r]===o?t.splice(r,1):e(t[r]);else if(p(t))for(var n in t)g(t,n)&&e(t[n])},t.traverse=w,t.setValue=function(e,t,r){w(e,t,(function(e,t){e[t]=r}),!0)},t.removeValue=function(e,t){w(e,t,(function(e,t){if(e instanceof Array)if(/^\d+$/.test(t))e.splice(parseInt(t),1);else for(var r=0,n=e;r<n.length;r++){var o=n[r];p(o)&&delete o[t]}else p(e)&&delete e[t]}))};var S=/^\$[a-zA-Z0-9_]+$/;function A(e){return S.test(e)}t.isOperator=A,t.normalize=function(e){if(t.inArray(s,c(e).toLowerCase()))return f(e)?{$regex:e}:{$eq:e};if(d(e)){if(!Object.keys(e).some(A))return{$eq:e};g(e,"$regex")&&(e.$regex=new RegExp(e.$regex,e.$options),delete e.$options)}return e}},2269:(e,t,r)=>{r.r(t),r.d(t,{createContext:()=>je,resolvers:()=>s,typeDefs:()=>o});const n=require("apollo-server"),o=n.gql`
  scalar JSON
  type Query {
    page(pageId: ID!): JSON
    lowdefyGlobal: JSON
    menu: MenuResponse
    request(input: RequestInput!): RequestResponse
  }

  input RequestInput {
    arrayIndices: JSON!
    blockId: String!
    event: JSON!
    input: JSON!
    lowdefyGlobal: JSON!
    pageId: String!
    requestId: String!
    state: JSON!
    urlQuery: JSON!
  }

  type MenuResponse {
    menus: [Menu]
    homePageId: String
  }

  type Menu {
    id: ID!
    menuId: String
    properties: JSON
    links: [MenuItem]
  }

  union MenuItem = MenuGroup | MenuLink

  type MenuGroup {
    id: ID
    type: String
    properties: JSON
    links: [MenuItem]
  }

  type MenuLink {
    id: ID
    type: String
    properties: JSON
    pageId: String
    url: String
  }

  type RequestResponse {
    id: ID!
    type: String
    success: Boolean
    response: JSON
  }
`,i=require("graphql-type-json"),s={JSON:r.n(i)(),Query:{lowdefyGlobal:async function(e,t,{getController:r}){return r("component").getLowdefyGlobal()},menu:async function(e,t,{getController:r}){return r("component").getMenus()},page:async function(e,{pageId:t},{getController:r}){return r("page").getPage({pageId:t})},request:function(e,{input:t},{getController:r}){return r("request").callRequest(t)}},MenuItem:{__resolveType:function(e){return"MenuLink"===e.type?"MenuLink":"MenuGroup"}}},a=require("@lowdefy/helpers");class u{constructor({getLoader:e}){this.pageLoader=e("page")}async getPage({pageId:e}){return this.pageLoader.load(e)}}const c=function(e){return new u(e)};class l{constructor({getLoader:e}){this.componentLoader=e("component")}async getLowdefyGlobal(){return await this.componentLoader.load("global")||{}}async getMenus(){const e=await this.componentLoader.load("menus")||[];return{menus:e,homePageId:await this.getHomePageId({menus:e})}}async getHomePageId({menus:e}){const t=await this.componentLoader.load("config");if(t&&(0,a.get)(t,"homePageId"))return(0,a.get)(t,"homePageId");let r=e.find((e=>"default"===e.menuId));r||(r=e[0]);let n=null;return n=(0,a.get)(r,"links.0.pageId",{default:null}),n||(n=(0,a.get)(r,"links.0.links.0.pageId",{default:null})),n||(n=(0,a.get)(r,"links.0.links.0.links.0.pageId",{default:null})),n}}const p=function(e){return new l(e)},d=require("@lowdefy/ajv"),f=require("@lowdefy/operators");class y extends n.ApolloError{constructor(e,t){super(e,"CONFIGURATION_ERROR",{displayTitle:"Configuration Error",displayMessage:e,...t}),Object.defineProperty(this,"name",{value:"ConfigurationError"})}}class h extends n.ApolloError{constructor(e,t){super(e,"REQUEST_ERROR",{displayTitle:"Request Error",displayMessage:e,...t}),Object.defineProperty(this,"name",{value:"RequestError"})}}const v=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Connection Schema - AwsS3Bucket","type":"object","required":["accessKeyId","secretAccessKey","region","bucket"],"properties":{"accessKeyId":{"type":"string","description":"AWS IAM access key id with s3 access.","errorMessage":{"type":"AwsS3Bucket connection property \\"accessKeyId\\" should be a string."}},"secretAccessKey":{"type":"string","description":"AWS IAM secret access key with s3 access.","errorMessage":{"type":"AwsS3Bucket connection property \\"secretAccessKey\\" should be a string."}},"region":{"type":"string","description":"AWS region the bucket is located in.","errorMessage":{"type":"AwsS3Bucket connection property \\"region\\" should be a string."}},"bucket":{"type":"string","description":"S3 bucket name.","errorMessage":{"type":"AwsS3Bucket connection property \\"bucket\\" should be a string."}},"read":{"type":"boolean","default":true,"description":"Allow reads from the bucket.","errorMessage":{"type":"AwsS3Bucket connection property \\"read\\" should be a boolean."}},"write":{"type":"boolean","default":false,"description":"Allow writes to the bucket.","errorMessage":{"type":"AwsS3Bucket connection property \\"write\\" should be a boolean."}}},"errorMessage":{"type":"AwsS3Bucket connection properties should be an object.","required":{"accessKeyId":"AwsS3Bucket connection should have required property \\"accessKeyId\\".","secretAccessKey":"AwsS3Bucket connection should have required property \\"secretAccessKey\\".","region":"AwsS3Bucket connection should have required property \\"region\\".","bucket":"AwsS3Bucket connection should have required property \\"bucket\\"."}}}'),g=require("aws-sdk");var m=r.n(g);const b={schema:v,requests:{AwsS3PresignedGetObject:{resolver:function({request:e,connection:t}){const{accessKeyId:r,secretAccessKey:n,region:o,bucket:i}=t,{expires:s,key:a,versionId:u,responseContentDisposition:c,responseContentType:l}=e,p={Bucket:i,Key:a,Expires:s,VersionId:u,ResponseContentDisposition:c,ResponseContentType:l};return new(m().S3)({accessKeyId:r,secretAccessKey:n,region:o,bucket:i}).getSignedUrl("getObject",p)},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - AwsS3PresignedGetObject","type":"object","required":["key"],"properties":{"expires":{"type":"number","description":"Number of seconds for which the policy should be valid.","default":3600,"errorMessage":{"type":"AwsS3PresignedGetObject request property \\"expires\\" should be a number."}},"key":{"type":"string","description":"Key under which object is stored.","errorMessage":{"type":"AwsS3PresignedGetObject request property \\"key\\" should be a string."}},"responseContentDisposition":{"type":"string","description":"Sets the Content-Disposition header of the response.","errorMessage":{"type":"AwsS3PresignedGetObject request property \\"responseContentDisposition\\" should be a string."}},"responseContentType":{"type":"string","description":"Sets the Content-Type header of the response.","errorMessage":{"type":"AwsS3PresignedGetObject request property \\"responseContentType\\" should be a string."}},"versionId":{"type":"string","description":"VersionId used to reference a specific version of the object.","errorMessage":{"type":"AwsS3PresignedGetObject request property \\"versionId\\" should be a string."}}},"errorMessage":{"type":"AwsS3PresignedGetObject request properties should be an object.","required":"AwsS3PresignedGetObject request should have required property \\"key\\"."}}'),checkRead:!0,checkWrite:!1},AwsS3PresignedPostPolicy:{resolver:function({request:e,connection:t}){const{accessKeyId:r,secretAccessKey:n,region:o,bucket:i}=t,{acl:s,conditions:a,expires:u,key:c}=e,l={Bucket:i,Fields:{key:c}};return a&&(l.Conditions=a),u&&(l.Expires=u),s&&(l.Fields.acl=s),new(m().S3)({accessKeyId:r,secretAccessKey:n,region:o,bucket:i}).createPresignedPost(l)},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - AwsS3PresignedPostPolicy","type":"object","required":["key"],"properties":{"acl":{"type":"string","enum":["private","public-read","public-read-write","aws-exec-read","authenticated-read","bucket-owner-read","bucket-owner-full-control"],"description":"Access control lists used to grant read and write access.","errorMessage":{"type":"AwsS3PresignedPostPolicy request property \\"acl\\" should be a string.","enum":"AwsS3PresignedPostPolicy request property \\"acl\\" is not one of \\"private\\", \\"public-read\\", \\"public-read-write\\", \\"aws-exec-read\\", \\"authenticated-read\\", \\"bucket-owner-read\\", \\"bucket-owner-full-control\\"."}},"conditions":{"type":"array","items":{"type":"array"},"description":"Conditions to be enforced on the request.","errorMessage":{"type":"AwsS3PresignedPostPolicy request property \\"conditions\\" should be a array."}},"expires":{"type":"number","description":"Number of seconds for which the policy should be valid.","default":3600,"errorMessage":{"type":"AwsS3PresignedPostPolicy request property \\"expires\\" should be a number."}},"key":{"type":"string","description":"Key under which object will be stored.","errorMessage":{"type":"AwsS3PresignedPostPolicy request property \\"key\\" should be a string."}}},"errorMessage":{"type":"AwsS3PresignedPostPolicy request properties should be an object.","required":"AwsS3PresignedPostPolicy request should have required property \\"key\\"."}}'),checkRead:!1,checkWrite:!0}}},O=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Connection Schema - AxiosHttp","type":"object","properties":{"url":{"type":"string","description":"The server URL that will be used for the request.","errorMessage":{"type":"AxiosHttp property \\"url\\" should be a string."}},"method":{"type":"string","enum":["get","delete","head","options","post","put","patch"],"description":"The request method to be used when making the request","errorMessage":{"type":"AxiosHttp property \\"method\\" should be a string.","enum":"AxiosHttp property \\"method\\" is not a valid value."}},"baseURL":{"type":"string","description":"baseURL will be prepended to url unless url is absolute. It can be convenient to set baseURL for an axios connection so that requests can use relative urls.","errorMessage":{"type":"AxiosHttp property \\"baseURL\\" should be a string."}},"headers":{"type":"object","description":"An object with custom headers to be sent sent with the request. The object keys should be header names, and the values should be the string header values.","errorMessage":{"type":"AxiosHttp property \\"headers\\" should be an object."}},"params":{"type":"object","description":"An object with URL parameters to be sent with the request.","errorMessage":{"type":"AxiosHttp property \\"params\\" should be an object."}},"data":{"type":["string","object"],"description":"The data to be sent as the request body. Only applicable for request methods \'put\', \'post\', and \'patch\'. Can be an object or a string in the format \'Country=USA&City=New York\'.","errorMessage":{"type":"AxiosHttp property \\"data\\" should be an object or string."}},"timeout":{"type":"number","description":"The number of milliseconds before the request times out. If the request takes longer than timeout, the request will be aborted. Set to 0 for no timeout.","default":0,"errorMessage":{"type":"AxiosHttp property \\"timeout\\" should be a number."}},"auth":{"type":"object","description":"Indicates that HTTP Basic authorization should be used, and supplies credentials. This will set an Authorization header, overwriting any existing Authorization custom headers you have set using headers. Only HTTP Basic auth is configurable through this parameter, for Bearer tokens and such, use Authorization custom headers instead.","properties":{"username":{"type":"string","description":"HTTP Basic authorization username.","errorMessage":{"type":"AxiosHttp property \\"auth.username\\" should be a string."}},"password":{"type":"string","description":"HTTP Basic authorization password.","errorMessage":{"type":"AxiosHttp property \\"auth.password\\" should be a string."}}},"errorMessage":{"type":"AxiosHttp property \\"auth\\" should be an object."}},"responseType":{"type":"string","enum":["json","document","text"],"description":"The type of data that the server should respond with.","default":"json","errorMessage":{"type":"AxiosHttp property \\"responseType\\" should be a string.","enum":"AxiosHttp property \\"responseType\\" is not a valid value."}},"responseEncoding":{"type":"string","description":"Indicates encoding to use for decoding responses.","default":"utf8","errorMessage":{"type":"AxiosHttp property \\"responseEncoding\\" should be a string."}},"maxContentLength":{"type":"number","description":"Defines the max size of the http response content allowed in bytes.","errorMessage":{"type":"AxiosHttp property \\"maxContentLength\\" should be a number."}},"maxRedirects":{"type":"number","description":"Defines the maximum number of redirects to follow. If set to 0, no redirects will be followed.","default":5,"errorMessage":{"type":"AxiosHttp property \\"maxRedirects\\" should be a number."}},"proxy":{"type":"object","description":"Defines the hostname and port of the proxy server.","errorMessage":{"type":"AxiosHttp property \\"proxy\\" should be an object."}}}}'),_=require("axios");var M=r.n(_);const $={schema:O,requests:{AxiosHttp:{resolver:async function({request:e,connection:t}){try{const r=(0,a.mergeObjects)([t,e]),n=await M()(r),{status:o,statusText:i,headers:s,method:u,path:c,data:l}=n;return{status:o,statusText:i,headers:s,method:u,path:c,data:l}}catch(e){if(e.response)throw new Error(`${e.message}; Http response "${e.response.status}: ${e.response.statusText}"; Data: ${JSON.stringify(e.response.data)}.`);throw e}},schema:O,checkRead:!1,checkWrite:!1}}},j=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Connection Schema - GoogleSheet","type":"object","required":["spreadsheetId"],"properties":{"apiKey":{"type":"string","description":"API key for your google project.","errorMessage":{"type":"GoogleSheet connection property \\"apiKey\\" should be a string."}},"client_email":{"type":"string","description":"The email of your service account.","errorMessage":{"type":"GoogleSheet connection property \\"client_email\\" should be a string."}},"private_key":{"type":"string","description":"The private key for your service account.","errorMessage":{"type":"GoogleSheet connection property \\"private_key\\" should be a string."}},"sheetId":{"type":"string","description":"The ID of the worksheet. Can be found in the URL as the \\"gid\\" parameter. One of \\"sheetId\\" or \\"sheetIndex\\" is required.","errorMessage":{"type":"GoogleSheet connection property \\"sheetId\\" should be a string."}},"sheetIndex":{"type":"number","description":"The position of the worksheet as they appear in the Google sheets UI. Starts from 0. One of \\"sheetId\\" or \\"sheetIndex\\" is required.","errorMessage":{"type":"GoogleSheet connection property \\"sheetIndex\\" should be a number."}},"spreadsheetId":{"type":"string","description":"document ID from the URL of the spreadsheet.","errorMessage":{"type":"GoogleSheet connection property \\"spreadsheetId\\" should be a string."}},"columnTypes":{"type":"object","description":"Define types for columns in the spreadsheet.","patternProperties":{"^.*$":{"type":"string","enum":["string","number","boolean","date","json"],"errorMessage":{"enum":"GoogleSheet connection property \\"{{ dataPath }}\\" should be one of \\"string\\", \\"number\\", \\"boolean\\", \\"date\\", or \\"json\\"."}}},"errorMessage":{"type":"GoogleSheet connection property \\"columnTypes\\" should be an object."}},"read":{"type":"boolean","default":true,"description":"Allow reads from the spreadsheet.","errorMessage":{"type":"GoogleSheet connection property \\"read\\" should be a boolean."}},"write":{"type":"boolean","default":false,"description":"Allow writes to the spreadsheet.","errorMessage":{"type":"GoogleSheet connection property \\"write\\" should be a boolean."}}},"errorMessage":{"type":"GoogleSheet connection properties should be an object.","required":{"spreadsheetId":"GoogleSheet connection should have required property \\"spreadsheetId\\"."}}}'),w=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - GoogleSheetAppendMany","type":"object","required":["rows"],"properties":{"rows":{"type":"array","description":"The rows to insert into the sheet. An an array of objects where keys are the column names and values are the values to insert.","errorMessage":{"type":"GoogleSheetAppendMany request property \\"rows\\" should be an array."},"items":{"type":"object","description":"The row to insert into the sheet. An object where keys are the column names and values are the values to insert.","errorMessage":{"type":"GoogleSheetAppendMany request property \\"rows\\" should be an array of objects."}}},"options":{"type":"object","properties":{"raw":{"type":"boolean","description":"Store raw values instead of converting as if typed into the sheets UI.","errorMessage":{"type":"GoogleSheetAppendMany request property \\"options.raw\\" should be a boolean."}}}}},"errorMessage":{"type":"GoogleSheetAppendMany request properties should be an object.","required":{"rows":"GoogleSheetAppendMany request should have required property \\"rows\\"."}}}'),S=require("google-spreadsheet"),A=async function({connection:e}){const{apiKey:t,client_email:r,private_key:n,sheetId:o,sheetIndex:i,spreadsheetId:s}=e,a=new S.GoogleSpreadsheet(s);return await async function({doc:e,apiKey:t,client_email:r,private_key:n}){t?e.useApiKey(t):await e.useServiceAccountAuth({client_email:r,private_key:n})}({doc:a,apiKey:t,client_email:r,private_key:n}),await a.loadInfo(),function({doc:e,sheetId:t,sheetIndex:r}){let n;if(t){if(n=e.sheetsById[t],!n)throw new Error(`Could not find sheet with sheetId "${t}"`)}else if(n=e.sheetsByIndex[r],!n)throw new Error(`Could not find sheet with sheetIndex ${r}`);return n}({doc:a,sheetId:o,sheetIndex:i})},P=require("moment");var q=r.n(P);const N={string:e=>e,number:e=>{const t=Number(e);return isNaN(t)?null:t},boolean:e=>"TRUE"===e,date:e=>{const t=q().utc(e);return t.isValid()?t.toDate():null},json:e=>{try{return JSON.parse(e)}catch(e){return null}}},T={string:e=>e,number:e=>a.type.isNumber(e)?e.toString():e,boolean:e=>!0===e?"TRUE":!1===e?"FALSE":e,date:e=>a.type.isDate(e)?e.toISOString():e,json:e=>{try{return JSON.stringify(e)}catch(t){return e}}},I=({transformers:e,types:t})=>r=>(Object.keys(r).forEach((n=>{t[n]&&(r[n]=e[t[n]](r[n]))})),r);function x({input:e,types:t={}}){if(a.type.isObject(e))return I({transformers:N,types:t})(e);if(a.type.isArray(e))return e.map((e=>I({transformers:N,types:t})(e)));throw new Error(`transformRead received invalid input type ${a.type.typeOf(e)}.`)}function E({input:e,types:t={}}){if(a.type.isObject(e))return I({transformers:T,types:t})(e);if(a.type.isArray(e))return e.map((e=>I({transformers:T,types:t})(e)));throw new Error(`transformWrite received invalid input type ${a.type.typeOf(e)}.`)}const D={resolver:async function({request:e,connection:t}){const{rows:r,options:n={}}=e,{raw:o}=n,i=await A({connection:t});return await i.addRows(E({input:r,types:t.columnTypes}),{raw:o}),{insertedCount:r.length}},schema:w,checkRead:!1,checkWrite:!0},k=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - GoogleSheetAppendOne","type":"object","required":["row"],"properties":{"row":{"type":"object","description":"The row to insert into the sheet. An object where keys are the column names and values are the values to insert.","errorMessage":{"type":"GoogleSheetAppendOne request property \\"row\\" should be an object."}},"options":{"type":"object","properties":{"raw":{"type":"boolean","description":"Store raw values instead of converting as if typed into the sheets UI.","errorMessage":{"type":"GoogleSheetAppendOne request property \\"options.raw\\" should be a boolean."}}}}},"errorMessage":{"type":"GoogleSheetAppendOne request properties should be an object.","required":{"row":"GoogleSheetAppendOne request should have required property \\"row\\"."}}}');function R(e){const{_sheet:t,...r}=e;return{...r}}const B=function(e){if(a.type.isObject(e))return R(e);if(a.type.isArray(e))return e.map((e=>R(e)));throw new Error(`cleanRows received invalid input type ${a.type.typeOf(e)}.`)},G={resolver:async function({request:e,connection:t}){const{row:r,options:n={}}=e,{raw:o}=n,i=await A({connection:t}),s=await i.addRow(E({input:r,types:t.columnTypes}),{raw:o});return{insertedCount:1,row:B(s)}},schema:k,checkRead:!1,checkWrite:!0},C=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - GoogleSheetDeleteOne","type":"object","required":["filter"],"properties":{"filter":{"type":"object","description":"A MongoDB query expression to filter the data. The first row matched by the filter will be deleted.","errorMessage":{"type":"GoogleSheetDeleteOne request property \\"filter\\" should be an object."}},"options":{"type":"object","properties":{"limit":{"type":"number","description":"The maximum number of rows to fetch.","errorMessage":{"type":"GoogleSheetDeleteOne request property \\"options.limit\\" should be a number."}},"skip":{"type":"number","description":"The number of rows to skip from the top of the sheet.","errorMessage":{"type":"GoogleSheetDeleteOne request property \\"options.skip\\" should be a number."}}}}},"errorMessage":{"type":"GoogleSheetDeleteOne request properties should be an object.","required":{"filter":"GoogleSheetDeleteOne request should have required property \\"filter\\"."}}}'),U=require("mingo");var L=r.n(U),V=r(8257),F=r(7661),J=r(8691),z=r(397),H=r(541),K=r(2148);(0,V.useOperators)(V.OperatorType.ACCUMULATOR,F),(0,V.useOperators)(V.OperatorType.EXPRESSION,J),(0,V.useOperators)(V.OperatorType.PIPELINE,z),(0,V.useOperators)(V.OperatorType.PROJECTION,H),(0,V.useOperators)(V.OperatorType.QUERY,K);const Q=function({input:e=[],pipeline:t=[]}){if(!a.type.isArray(e))throw new Error('Mingo aggregation error. Argument "input" should be an array.');if(!a.type.isArray(t))throw new Error('Mingo aggregation error. Argument "pipeline" should be an array.');return new(L().Aggregator)(t).run(e)},W=function({input:e=[],filter:t={}}){if(!a.type.isObject(t))throw new Error('Mingo filter error. Argument "filter" should be an object.');if(!a.type.isArray(e))throw new Error('Mingo filter error. Argument "input" should be an array.');return Q({input:e,pipeline:[{$match:t}]})},Y={schema:j,requests:{GoogleSheetAppendMany:D,GoogleSheetAppendOne:G,GoogleSheetDeleteOne:{resolver:async function({request:e,connection:t}){const{filter:r,options:n={}}=e,{limit:o,skip:i}=n,s=await A({connection:t});let a=await s.getRows({limit:o,offset:i});if(a=x({input:a,types:t.columnTypes}),a=W({input:a,filter:r}),0===a.length)return{deletedCount:0};const u=a[0];return await u.delete(),{deletedCount:1,row:B(u)}},schema:C,checkRead:!1,checkWrite:!0},GoogleSheetGetMany:{resolver:async function({request:e,connection:t}){const{filter:r,pipeline:n,options:o={}}=e,{limit:i,skip:s}=o,a=await A({connection:t});let u=await a.getRows({limit:i,offset:s});return u=B(u),u=x({input:u,types:t.columnTypes}),r&&(u=W({input:u,filter:r})),n&&(u=Q({input:u,pipeline:n})),u},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - GoogleSheetGetMany","type":"object","properties":{"filter":{"type":"object","description":"A MongoDB query expression to filter the data.","errorMessage":{"type":"GoogleSheetGetMany request property \\"filter\\" should be an object."}},"pipeline":{"type":"array","description":"A MongoDB aggregation pipeline to transform the data.","errorMessage":{"type":"GoogleSheetGetMany request property \\"pipeline\\" should be an array."}},"options":{"type":"object","properties":{"limit":{"type":"number","description":"The maximum number of rows to fetch.","errorMessage":{"type":"GoogleSheetGetMany request property \\"options.limit\\" should be a number."}},"skip":{"type":"number","description":"The number of rows to skip from the top of the sheet.","errorMessage":{"type":"GoogleSheetGetMany request property \\"options.skip\\" should be a number."}}}}},"errorMessage":{"type":"GoogleSheetGetMany request properties should be an object."}}'),checkRead:!0,checkWrite:!1},GoogleSheetGetOne:{resolver:async function({request:e,connection:t}){const{filter:r,options:n={}}=e,{limit:o,skip:i}=n,s=await A({connection:t});let a=await s.getRows({limit:o,offset:i});return a=B(a),a=x({input:a,types:t.columnTypes}),r&&(a=W({input:a,filter:r})),a[0]||null},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - GoogleSheetGetOne","type":"object","properties":{"filter":{"type":"object","description":"A MongoDB query expression to filter the data.","errorMessage":{"type":"GoogleSheetGetOne request property \\"filter\\" should be an object."}},"options":{"type":"object","properties":{"limit":{"type":"number","description":"The maximum number of rows to fetch.","errorMessage":{"type":"GoogleSheetGetOne request property \\"options.limit\\" should be a number."}},"skip":{"type":"number","description":"The number of rows to skip from the top of the sheet.","errorMessage":{"type":"GoogleSheetGetOne request property \\"options.skip\\" should be a number."}}}}},"errorMessage":{"type":"GoogleSheetGetOne request properties should be an object."}}'),checkRead:!0,checkWrite:!1},GoogleSheetUpdateOne:{resolver:async function({request:e,connection:t}){const{filter:r,update:n,options:o={}}=e,{limit:i,skip:s,upsert:a,raw:u}=o,c=await A({connection:t});let l=await c.getRows({limit:i,offset:s});l=x({input:l,types:t.columnTypes}),l=W({input:l,filter:r});const p=E({input:n,types:t.columnTypes});if(0===l.length){if(a){const e=await c.addRow(p,{raw:u});return{modifiedCount:1,upserted:!0,row:B(e)}}return{modifiedCount:0,upserted:!1}}const d=l[0];return Object.assign(d,p),await d.save({raw:u}),{modifiedCount:1,upserted:!1,row:B(d)}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - GoogleSheetUpdateOne","type":"object","required":["update","filter"],"properties":{"filter":{"type":"object","description":"A MongoDB query expression to filter the data. The first row matched by the filter will be updated.","errorMessage":{"type":"GoogleSheetUpdateOne request property \\"filter\\" should be an object."}},"update":{"type":"object","description":"The update to apply to the row. An object where keys are the column names and values are the updated values.","errorMessage":{"type":"GoogleSheetUpdateOne request property \\"update\\" should be an object."}},"options":{"type":"object","properties":{"limit":{"type":"number","description":"The maximum number of rows to fetch.","errorMessage":{"type":"GoogleSheetUpdateOne request property \\"options.limit\\" should be a number."}},"raw":{"type":"boolean","description":"Store raw values instead of converting as if typed into the sheets UI.","errorMessage":{"type":"GoogleSheetUpdateOne request property \\"options.raw\\" should be a boolean."}},"skip":{"type":"number","description":"The number of rows to skip from the top of the sheet.","errorMessage":{"type":"GoogleSheetUpdateOne request property \\"options.skip\\" should be a number."}},"upsert":{"type":"boolean","description":"Insert the row if no rows are matched by the filter.","errorMessage":{"type":"GoogleSheetUpdateOne request property \\"options.upsert\\" should be a boolean."}}}}},"errorMessage":{"type":"GoogleSheetUpdateOne request properties should be an object.","required":{"filter":"GoogleSheetUpdateOne request should have required property \\"filter\\".","update":"GoogleSheetUpdateOne request should have required property \\"update\\"."}}}'),checkRead:!1,checkWrite:!0},GoogleSheetUpdateMany:{resolver:async function({request:e,connection:t}){const{filter:r,update:n,options:o={}}=e,{limit:i,skip:s,raw:a}=o,u=await A({connection:t});let c=await u.getRows({limit:i,offset:s});c=x({input:c,types:t.columnTypes}),c=W({input:c,filter:r});const l=E({input:n,types:t.columnTypes});if(0===c.length)return{modifiedCount:0};const p=c.map((async e=>{Object.assign(e,l),await e.save({raw:a})}));return await Promise.all(p),{modifiedCount:c.length}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - GoogleSheetUpdateMany","type":"object","required":["update","filter"],"properties":{"filter":{"type":"object","description":"A MongoDB query expression to filter the data. All rows matched by the filter will be updated.","errorMessage":{"type":"GoogleSheetUpdateMany request property \\"filter\\" should be an object."}},"update":{"type":"object","description":"The update to apply to the row. An object where keys are the column names and values are the updated values.","errorMessage":{"type":"GoogleSheetUpdateMany request property \\"update\\" should be an object."}},"options":{"type":"object","properties":{"limit":{"type":"number","description":"The maximum number of rows to fetch.","errorMessage":{"type":"GoogleSheetUpdateMany request property \\"options.limit\\" should be a number."}},"raw":{"type":"boolean","description":"Store raw values instead of converting as if typed into the sheets UI.","errorMessage":{"type":"GoogleSheetUpdateMany request property \\"options.raw\\" should be a boolean."}},"skip":{"type":"number","description":"The number of rows to skip from the top of the sheet.","errorMessage":{"type":"GoogleSheetUpdateMany request property \\"options.skip\\" should be a number."}}}}},"errorMessage":{"type":"GoogleSheetUpdateMany request properties should be an object.","required":{"filter":"GoogleSheetUpdateMany request should have required property \\"filter\\".","update":"GoogleSheetUpdateMany request should have required property \\"update\\"."}}}'),checkRead:!1,checkWrite:!0}}},X=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Connection Schema - MongoDBCollection","type":"object","required":["databaseUri","collection"],"properties":{"databaseUri":{"type":"string","description":"Connection uri string for the MongoDb deployment.","errorMessage":{"type":"MongoDBCollection connection property \\"databaseUri\\" should be a string."}},"databaseName":{"type":"string","description":"AWS IAM secret access key with s3 access.","errorMessage":{"type":"MongoDBCollection connection property \\"databaseName\\" should be a string."}},"collection":{"type":"string","description":"AWS region the bucket is located in.","errorMessage":{"type":"MongoDBCollection connection property \\"collection\\" should be a string."}},"read":{"type":"boolean","default":true,"description":"Allow reads from the collection.","errorMessage":{"type":"MongoDBCollection connection property \\"read\\" should be a boolean."}},"write":{"type":"boolean","default":false,"description":"Allow writes to the collection.","errorMessage":{"type":"MongoDBCollection connection property \\"write\\" should be a boolean."}}},"errorMessage":{"type":"MongoDBCollection connection properties should be an object.","required":{"databaseUri":"MongoDBCollection connection should have required property \\"databaseUri\\".","collection":"MongoDBCollection connection should have required property \\"collection\\"."}}}'),Z=require("mongodb"),ee=async function({connection:e}){let t;const{databaseUri:r,databaseName:n,collection:o}=e;t=new Z.MongoClient(r,{useNewUrlParser:!0,useUnifiedTopology:!0}),await t.connect();try{const e=t.db(n);return{client:t,collection:e.collection(o)}}catch(e){throw await t.close(),e}};function te(e,t){return a.type.isObject(t)?(Object.keys(t).forEach((e=>{t[e]instanceof Z.ObjectID&&(t[e]={_oid:t[e].toHexString()}),a.type.isDate(t[e])&&(t[e]={_date:t[e].valueOf()})})),t):a.type.isArray(t)?t.map((e=>e instanceof Z.ObjectID?{_oid:e.toHexString()}:a.type.isDate(e)?{_date:e.valueOf()}:e)):t}function re(e,t){if(a.type.isObject(t)){if(t._oid)return Z.ObjectID.createFromHexString(t._oid);if(a.type.isInt(t._date)||a.type.isString(t._date))return new Date(t._date)}return t}function ne(e){return a.type.isUndefined(e)?e:JSON.parse(JSON.stringify(e,te))}function oe(e){return a.type.isUndefined(e)?e:JSON.parse(JSON.stringify(e,te),re)}const ie={schema:X,requests:{MongoDBAggregation:{resolver:async function({request:e,connection:t}){const r=oe(e),{pipeline:n,options:o}=r;!function({pipeline:e,connection:t}){!0!==t.write&&e.forEach((e=>{if(null!=e.$out||null!=e.$merge)throw new Error('Connection does not allow writes and aggregation pipeline contains a "$merge" or "$out" stage.')}))}({pipeline:n,connection:t});const{collection:i,client:s}=await ee({connection:t});let a;try{const e=await i.aggregate(n,o);a=await e.toArray()}catch(e){throw await s.close(),e}return await s.close(),ne(a)},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBAggregation","type":"object","required":["pipeline"],"properties":{"pipeline":{"type":"array","description":"Array containing all the aggregation framework commands for the execution.","errorMessage":{"type":"MongoDBAggregation request property \\"pipeline\\" should be an array."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBAggregation request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBAggregation request properties should be an object.","required":"MongoDBAggregation request should have required property \\"pipeline\\"."}}'),checkRead:!0,checkWrite:!1},MongoDBDeleteMany:{resolver:async function({request:e,connection:t}){const r=oe(e),{filter:n,options:o}=r,{collection:i,client:s}=await ee({connection:t});let a;try{a=await i.deleteMany(n,o)}catch(e){throw await s.close(),e}await s.close();const{deletedCount:u}=ne(a);return{deletedCount:u}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBDeleteMany","type":"object","required":["filter"],"properties":{"filter":{"type":"object","description":"The filter used to select the document to update.","errorMessage":{"type":"MongoDBDeleteMany request property \\"filter\\" should be an object."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBDeleteMany request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBDeleteMany request properties should be an object.","required":"MongoDBDeleteMany request should have required property \\"filter\\"."}}'),checkRead:!1,checkWrite:!0},MongoDBDeleteOne:{resolver:async function({request:e,connection:t}){const r=oe(e),{filter:n,options:o}=r,{collection:i,client:s}=await ee({connection:t});let a;try{a=await i.deleteOne(n,o)}catch(e){throw await s.close(),e}await s.close();const{deletedCount:u}=ne(a);return{deletedCount:u}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBDeleteOne","type":"object","required":["filter"],"properties":{"filter":{"type":"object","description":"The filter used to select the document to update.","errorMessage":{"type":"MongoDBDeleteOne request property \\"filter\\" should be an object."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBDeleteOne request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBDeleteOne request properties should be an object.","required":"MongoDBDeleteOne request should have required property \\"filter\\"."}}'),checkRead:!1,checkWrite:!0},MongoDBFind:{resolver:async function({request:e,connection:t}){const r=oe(e),{query:n,options:o}=r,{collection:i,client:s}=await ee({connection:t});let a;try{const e=await i.find(n,o);a=await e.toArray()}catch(e){throw await s.close(),e}return await s.close(),ne(a)},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBFind","type":"object","required":["query"],"properties":{"query":{"type":"object","description":"A MongoDB query object","errorMessage":{"type":"MongoDBFind request property \\"query\\" should be an object."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBFind request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBFind request properties should be an object.","required":"MongoDBFind request should have required property \\"query\\"."}}'),checkRead:!0,checkWrite:!1},MongoDBFindOne:{resolver:async function({request:e,connection:t}){const r=oe(e),{query:n,options:o}=r,{collection:i,client:s}=await ee({connection:t});let a;try{a=await i.findOne(n,o)}catch(e){throw await s.close(),e}return await s.close(),ne(a)},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBFindOne","type":"object","required":["query"],"properties":{"query":{"type":"object","description":"A MongoDB query object","errorMessage":{"type":"MongoDBFindOne request property \\"query\\" should be an object."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBFindOne request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBFindOne request properties should be an object.","required":"MongoDBFindOne request should have required property \\"query\\"."}}'),checkRead:!0,checkWrite:!1},MongoDBInsertMany:{resolver:async function({request:e,connection:t}){const r=oe(e),{docs:n,options:o}=r,{collection:i,client:s}=await ee({connection:t});let a;try{a=await i.insertMany(n,o)}catch(e){throw await s.close(),e}await s.close();const{insertedCount:u,ops:c}=ne(a);return{insertedCount:u,ops:c}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBInsertMany","type":"object","required":["docs"],"properties":{"docs":{"type":"array","description":"The array of documents to be inserted.","errorMessage":{"type":"MongoDBInsertMany request property \\"docs\\" should be an array."},"items":{"type":"object","errorMessage":{"type":"MongoDBInsertMany request property \\"docs\\" should be an array of documents to insert."}}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBInsertMany request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBInsertMany request properties should be an object.","required":"MongoDBInsertMany request should have required property \\"docs\\"."}}'),checkRead:!1,checkWrite:!0},MongoDBInsertOne:{resolver:async function({request:e,connection:t}){const r=oe(e),{doc:n,options:o}=r,{collection:i,client:s}=await ee({connection:t});let a;try{a=await i.insertOne(n,o)}catch(e){throw await s.close(),e}await s.close();const{insertedCount:u,insertedId:c,ops:l}=ne(a);return{insertedCount:u,insertedId:c,ops:l}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBInsertOne","type":"object","required":["doc"],"properties":{"doc":{"type":"object","description":"The document to be inserted.","errorMessage":{"type":"MongoDBInsertOne request property \\"doc\\" should be an object."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBInsertOne request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBInsertOne request properties should be an object.","required":"MongoDBInsertOne request should have required property \\"doc\\"."}}'),checkRead:!1,checkWrite:!0},MongoDBUpdateMany:{resolver:async function({request:e,connection:t}){const r=oe(e),{filter:n,update:o,options:i}=r,{collection:s,client:a}=await ee({connection:t});let u;try{u=await s.updateMany(n,o,i)}catch(e){throw await a.close(),e}await a.close();const{modifiedCount:c,upsertedId:l,upsertedCount:p,matchedCount:d}=ne(u);return{modifiedCount:c,upsertedId:l,upsertedCount:p,matchedCount:d}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBUpdateMany","type":"object","required":["filter","update"],"properties":{"filter":{"type":"object","description":"The filter used to select the documents to update.","errorMessage":{"type":"MongoDBUpdateMany request property \\"filter\\" should be an object."}},"update":{"type":["object","array"],"description":"The update operations to be applied to the documents.","errorMessage":{"type":"MongoDBUpdateMany request property \\"update\\" should be an object."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBUpdateMany request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBUpdateMany request properties should be an object.","required":{"filter":"MongoDBUpdateMany request should have required property \\"filter\\".","update":"MongoDBUpdateMany request should have required property \\"update\\"."}}}'),checkRead:!1,checkWrite:!0},MongoDBUpdateOne:{resolver:async function({request:e,connection:t}){const r=oe(e),{filter:n,update:o,options:i}=r,{collection:s,client:a}=await ee({connection:t});let u;try{u=await s.updateOne(n,o,i)}catch(e){throw await a.close(),e}await a.close();const{modifiedCount:c,upsertedId:l,upsertedCount:p,matchedCount:d}=ne(u);return{modifiedCount:c,upsertedId:l,upsertedCount:p,matchedCount:d}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - MongoDBUpdateOne","type":"object","required":["filter","update"],"properties":{"filter":{"type":"object","description":"The filter used to select the document to update.","errorMessage":{"type":"MongoDBUpdateOne request property \\"filter\\" should be an object."}},"update":{"type":["object","array"],"description":"The update operations to be applied to the document.","errorMessage":{"type":"MongoDBUpdateOne request property \\"update\\" should be an object."}},"options":{"type":"object","description":"Optional settings.","errorMessage":{"type":"MongoDBUpdateOne request property \\"options\\" should be an object."}}},"errorMessage":{"type":"MongoDBUpdateOne request properties should be an object.","required":{"filter":"MongoDBUpdateOne request should have required property \\"filter\\".","update":"MongoDBUpdateOne request should have required property \\"update\\"."}}}'),checkRead:!1,checkWrite:!0}}},se=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Connection Schema - SendGridMail","type":"object","definitions":{"email":{"anyOf":[{"type":"string","examples":["someone@example.org","Name One <someone@example.org>"],"errorMessage":{"type":"SendGridMail connection property \\"{{ dataPath }}\\" should be a string."}},{"type":"object","required":["name","email"],"properties":{"name":{"type":"string","examples":["Some One"],"errorMessage":{"type":"SendGridMail connection property \\"{{ dataPath }}\\" should be a string."}},"email":{"type":"string","examples":["someone@example.org"],"errorMessage":{"type":"SendGridMail connection property \\"{{ dataPath }}\\" should be a string."}}},"errorMessage":{"type":"SendGridMail connection property \\"{{ dataPath }}\\" should be an object with properties \\"name\\" and \\"email\\"."}}],"errorMessage":{"anyOf":"SendGridMail connection property \\"{{ dataPath }}\\" should be an email address, or an object with properties \\"name\\" and \\"email\\"."}},"emails":{"anyOf":[{"$ref":"#/definitions/email"},{"type":"array","items":{"$ref":"#/definitions/email"},"errorMessage":{"type":"SendGridMail connection property \\"{{ dataPath }}\\" should be a list of email addresses"}}],"errorMessage":{"anyOf":"SendGridMail connection property \\"{{ dataPath }}\\" should be an email address, or a list of email addresses."}}},"required":["apiKey","from"],"properties":{"from":{"$ref":"#/definitions/emails","description":"Email address to send email from."},"apiKey":{"type":"string","description":"SendGrid API key.","errorMessage":{"type":"SendGridMail connection property \\"apiKey\\" should be a string."}},"templateId":{"type":"string","description":"SendGrid email template ID to render email when sending.","errorMessage":{"type":"SendGridMail connection property \\"templateId\\" should be a string."}},"mailSettings":{"type":"object","properties":{"sandboxMode":{"type":"object","properties":{"enable":{"type":"boolean","errorMessage":{"type":"SendGridMail connection property \\"mailSettings.sandboxMode.enable\\" should be a boolean."}}},"errorMessage":{"type":"SendGridMail connection property \\"mailSettings.sandboxMode\\" should be an object."}}},"errorMessage":{"type":"SendGridMail connection property \\"mailSettings\\" should be an object."}}},"errorMessage":{"type":"SendGridMail connection properties should be an object.","required":{"apiKey":"SendGridMail connection should have required property \\"apiKey\\".","from":"SendGridMail connection should have required property \\"from\\"."}}}'),ae=require("@sendgrid/mail");var ue=r.n(ae);const ce={AwsS3bucket:b,AxiosHttp:$,GoogleSheet:Y,MongoDBCollection:ie,SendGridMail:{schema:se,requests:{SendGridMailSend:{resolver:async function({request:e,connection:t}){const{apiKey:r,from:n,templateId:o,mailSettings:i}=t,{to:s,cc:a,bcc:u,replyTo:c,subject:l,text:p,html:d,dynamicTemplateData:f,attachments:y,categories:h,sendAt:v,batchId:g}=e;ue().setApiKey(r);const m={to:s,cc:a,bcc:u,from:n,replyTo:c,subject:l,text:p,html:d,templateId:o,dynamicTemplateData:f,attachments:y,categories:h,sendAt:v,batchId:g,mailSettings:i};try{await ue().send(m)}catch(e){if(e.response)throw new Error(JSON.stringify(e.response.body));throw e}return{response:"Mail sent successfully"}},schema:JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Lowdefy Request Schema - SendGridMailSend","type":"object","definitions":{"email":{"anyOf":[{"type":"string","examples":["someone@example.org","Name One <someone@example.org>"],"errorMessage":{"type":"SendGridMailSend request property \\"{{ dataPath }}\\" should be a string."}},{"type":"object","required":["name","email"],"properties":{"name":{"type":"string","examples":["Some One"],"errorMessage":{"type":"SendGridMailSend request property \\"{{ dataPath }}\\" should be a string."}},"email":{"type":"string","examples":["someone@example.org"],"errorMessage":{"type":"SendGridMailSend request property \\"{{ dataPath }}\\" should be a string."}}},"errorMessage":{"type":"SendGridMailSend request property \\"{{ dataPath }}\\" should be an object with properties \\"name\\" and \\"email\\"."}}],"errorMessage":{"anyOf":"SendGridMailSend request property \\"{{ dataPath }}\\" should be an email address, or an object with properties \\"name\\" and \\"email\\"."}},"emails":{"anyOf":[{"$ref":"#/definitions/email"},{"type":"array","items":{"$ref":"#/definitions/email"},"errorMessage":{"type":"SendGridMailSend request property \\"{{ dataPath }}\\" should be a list of email addresses"}}],"errorMessage":{"anyOf":"SendGridMailSend request property \\"{{ dataPath }}\\" should be an email address, or a list of email addresses."}},"oneRequest":{"type":"object","required":["to"],"properties":{"to":{"$ref":"#/definitions/emails","description":"Email address to send to."},"cc":{"$ref":"#/definitions/emails","description":"Email address to cc in communication."},"bcc":{"$ref":"#/definitions/emails","description":"Email address to bcc in communication."},"replyTo":{"$ref":"#/definitions/emails","description":"Email address to reply to."},"subject":{"type":"string","description":"Email subject.","errorMessage":{"type":"SendGridMailSend request property \\"subject\\" should be a string."}},"text":{"type":"string","description":"Email message in plain text format.","errorMessage":{"type":"SendGridMailSend request property \\"text\\" should be a string."}},"html":{"type":"string","description":"Email message in html format.","errorMessage":{"type":"SendGridMailSend request property \\"html\\" should be a string."}},"dynamicTemplateData":{"type":"object","description":"SendGrid template data to render into email template.","errorMessage":{"type":"SendGridMailSend request property \\"dynamicTemplateData\\" should be an object."}},"attachments":{"type":"array","description":"List of email attachments to include with email.","items":{"type":"object","properties":{"content":{"type":"string","description":"Base 64 encoded attachment content.","errorMessage":{"type":"SendGridMailSend request property \\"content\\" should be a string."}},"filename":{"type":"string","description":"Name of the attachment file.","errorMessage":{"type":"SendGridMailSend request property \\"filename\\" should be a string."}},"type":{"type":"string","description":"The mime type of the content you are attaching. For example, \'text/plain\' or \'text/html\'.","errorMessage":{"type":"SendGridMailSend request property \\"type\\" should be a string."}},"disposition":{"type":"string","errorMessage":{"type":"SendGridMailSend request property \\"disposition\\" should be a string."}},"contentId":{"type":"string","errorMessage":{"type":"SendGridMailSend request property \\"contentId\\" should be a string."}}},"errorMessage":{"type":"SendGridMailSend request property \\"attachments\\" should be an array of objects."}},"errorMessage":{"type":"SendGridMailSend request property \\"attachments\\" should be an array."}},"categories":{"type":"array","items":{"type":"string","errorMessage":{"type":"SendGridMailSend request property \\"categories\\" should be an array of strings."}},"errorMessage":{"type":"SendGridMailSend request property \\"categories\\" should be an array."}},"sendAt":{"type":"integer","description":"A unix timestamp allowing you to specify when you want your email to be delivered. You can\'t schedule more than 72 hours in advance."},"templateId":{"type":"string","description":"SendGrid email template ID to render email when sending."}},"errorMessage":{"required":{"to":"SendGridMailSend request should have required property \\"to\\"."}}}},"anyOf":[{"$ref":"#/definitions/oneRequest"},{"type":"array","items":{"$ref":"#/definitions/oneRequest"}}],"errorMessage":{"anyOf":"SendGridMailSend request properties should be an object or a array describing emails to send."}}'),checkRead:!1,checkWrite:!1}}}};class le{constructor({getLoader:e,getSecrets:t}){this.getSecrets=t,this.requestLoader=e("request"),this.connectionLoader=e("connection")}async callRequest(e){const{arrayIndices:t,blockId:r,pageId:n,requestId:o}=e,i=await this.loadRequest({pageId:n,contextId:r,requestId:o}),s=await this.loadConnection({connectionId:i.connectionId}),u=this.getConnectionDefinition({connection:s,request:i}),c=this.getRequestDefinition({connectionDefinition:u,request:i}),{event:l,input:p,lowdefyGlobal:f,state:h,urlQuery:v}=this.deserializeInputs(e),{connectionProperties:g,requestProperties:m}=await this.parseOperators({event:l,arrayIndices:t,connection:s,input:p,lowdefyGlobal:f,request:i,state:h,urlQuery:v});this.checkConnectionRead({connectionId:i.connectionId,connectionProperties:g,checkRead:c.checkRead}),this.checkConnectionWrite({connectionId:i.connectionId,connectionProperties:g,checkWrite:c.checkWrite});try{(0,d.validate)({schema:u.schema,data:g}),(0,d.validate)({schema:c.schema,data:m})}catch(e){throw new y(e)}const b=await this.callResolver({connectionProperties:g,requestProperties:m,resolver:c.resolver});return{id:i.id,success:!0,type:i.type,response:a.serializer.serialize(b)}}async loadRequest({pageId:e,contextId:t,requestId:r}){const n=await this.requestLoader.load({pageId:e,contextId:t,requestId:r});if(!n)throw new y(`Request "${r}" does not exist.`);if(!n.connectionId)throw new y(`Request "${r}" does not specify a connection.`);return n}async loadConnection({connectionId:e}){const t=await this.connectionLoader.load(e);if(!t)throw new y(`Connection "${e}" does not exist.`);return t}getConnectionDefinition({connection:e,request:t}){const r=ce[e.type];if(!r)throw new y(`Request "${t.requestId}" has invalid connection type "${e.type}".`);return r}getRequestDefinition({connectionDefinition:e,request:t}){const r=e.requests[t.type];if(!r)throw new y(`Request "${t.requestId}" has invalid request type "${t.type}".`);return r}deserializeInputs({event:e,input:t,lowdefyGlobal:r,state:n,urlQuery:o}){return a.serializer.deserialize({event:e,input:t,lowdefyGlobal:r,state:n,urlQuery:o})}async parseOperators({event:e,arrayIndices:t,connection:r,input:n,lowdefyGlobal:o,request:i,state:s,urlQuery:a}){const u=await this.getSecrets(),c=new f.NodeParser({arrayIndices:t,input:n,lowdefyGlobal:o,secrets:u,state:s,urlQuery:a}),{output:l,errors:p}=c.parse({event:e,input:r.properties||{},location:r.connectionId});if(p.length>0)throw new h(p[0]);const{output:d,errors:y}=c.parse({event:e,input:i.properties||{},location:i.requestId});if(y.length>0)throw new h(y[0]);return{connectionProperties:l,requestProperties:d}}checkConnectionRead({connectionId:e,connectionProperties:t,checkRead:r}){if(r&&!1===t.read)throw new y(`Connection "${e}" does not allow reads.`)}checkConnectionWrite({connectionId:e,connectionProperties:t,checkWrite:r}){if(r&&!0!==t.write)throw new y(`Connection "${e}" does not allow writes.`)}async callResolver({connectionProperties:e,requestProperties:t,resolver:r}){try{return await r({request:t,connection:e})}catch(e){if(e instanceof y||e instanceof h)throw e;throw new h(e.message)}}}const pe=function(e){return new le(e)},de=function(e){const t={page:c,component:p,request:pe},r={};return function(n){if(!a.type.isUndefined(r[n]))return r[n];const o=t[n](e);return r[n]=o,o}},fe=require("path");var ye=r.n(fe);const he=require("dataloader");var ve=r.n(he);const ge=require("@lowdefy/node-utils"),me=async function({filePath:e}){const t=await(0,ge.readFile)(e);try{return JSON.parse(t)}catch(e){throw new y(e)}};const be=function({CONFIGURATION_BASE_PATH:e}){return new(ve())(function({CONFIGURATION_BASE_PATH:e}){return async function(t){return t.map((t=>async function(t){const r=ye().resolve(e,`${t}.json`);return me({filePath:r})}(t)))}}({CONFIGURATION_BASE_PATH:e}))};const Oe=function({CONFIGURATION_BASE_PATH:e}){return new(ve())(function({CONFIGURATION_BASE_PATH:e}){return async function(t){return t.map((t=>async function(t){const r=ye().resolve(e,`connections/${t}.json`);return me({filePath:r})}(t)))}}({CONFIGURATION_BASE_PATH:e}))};const _e=function({CONFIGURATION_BASE_PATH:e}){return new(ve())(function({CONFIGURATION_BASE_PATH:e}){return async function(t){return t.map((t=>async function(t){const r=ye().resolve(e,`pages/${t}/${t}.json`);return me({filePath:r})}(t)))}}({CONFIGURATION_BASE_PATH:e}))};function Me({pageId:e,contextId:t,requestId:r}){return`${e}:${t}:${r}`}const $e=function({CONFIGURATION_BASE_PATH:e}){return new(ve())(function({CONFIGURATION_BASE_PATH:e}){return async function(t){return t.map((t=>async function({pageId:t,contextId:r,requestId:n}){const o=ye().resolve(e,`pages/${t}/requests/${r}/${n}.json`);return me({filePath:o})}(t)))}}({CONFIGURATION_BASE_PATH:e}),{cacheKeyFn:Me})},je=function(e){const{CONFIGURATION_BASE_PATH:t,logger:r,getSecrets:n}=e,o={CONFIGURATION_BASE_PATH:t,logger:r,getSecrets:n};return async function(){return o.getLoader=function(e){const t={component:be,connection:Oe,page:_e,request:$e},r={};return function(n){if(!a.type.isUndefined(r[n]))return r[n];const o=t[n](e);return r[n]=o,o}}(o),{getController:de(o),logger:r}}}}},t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n=r(2269),o=exports;for(var i in n)o[i]=n[i];n.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();